<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Ordinary Differential Equations &mdash; Theoretical Physics Reference 0.5 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Theoretical Physics Reference 0.5 documentation" href="../index.html" />
    <link rel="up" title="Mathematics" href="main.html" />
    <link rel="next" title="Linear Algebra" href="la.html" />
    <link rel="prev" title="Wigner D Function" href="wigner.html" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28893880-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
     

  </head>
  <body>
    <div style="display:none">
    \(
        \newcommand{\d}{\mathrm{d}}
        \newcommand{\bomega}{\vec\omega}
        \newcommand{\half}{ {1\over 2} }
        \def\mathnot#1{\text{"$#1$"}}

        %operators
        \newcommand{\diag}{\mathrm{diag}}
        \newcommand{\sinc}{\mathrm{sinc}}
        \newcommand{\Sh}{ {\large\style{font-family:Times}{\text{Ш}}} }
        \newcommand{\res}{\mathrm{Res}}
    \)
    </div>
    

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="la.html" title="Linear Algebra"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="wigner.html" title="Wigner D Function"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Theoretical Physics Reference 0.5 documentation</a> &raquo;</li>
          <li><a href="main.html" accesskey="U">Mathematics</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="ordinary-differential-equations">
<h1>Ordinary Differential Equations<a class="headerlink" href="#ordinary-differential-equations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="finite-difference-formulas">
<h2>Finite Difference Formulas<a class="headerlink" href="#finite-difference-formulas" title="Permalink to this headline">¶</a></h2>
<p>We define the backward difference operator <span class="math">\(\nabla_h\)</span> by:</p>
<div class="math">
\[\nabla_h f(a) = f(a) - f(a-h)\]</div>
<p>Repeated application gives:</p>
<div class="math">
\[\nabla_h^2 f(a) = \nabla_h (f(a) - f(a-h))
    = f(a) - f(a-h) -f(a-h) + f(a-2h)
    = f(a) - 2f(a-h) + f(a-2h)\]\[\nabla_h^3 f(a) = f(a) - 3f(a-h) + 3f(a-2h)-f(a-3h)\]\[\nabla_h^n f(a) = \sum_{k=0}^n \binom{n}{k}(-1)^k f(a-kh)\]</div>
<p>We can also derive a formula for <span class="math">\(f(a+t)\)</span> where <span class="math">\(t\)</span> is any real number,
independent of <span class="math">\(h\)</span>:</p>
<div class="math">
\[f(a-h) = (1-\nabla_h) f(a)\]\[(1-\nabla_h)^{-1} f(a-h) = f(a)\]\[(1-\nabla_h)^{-1} f(a) = f(a+h)\]\[(1-\nabla_h)^{-n} f(a) = f(a+nh)\]\[(1-\nabla_h)^{-{t\over h}} f(a) = f(a+t)\]</div>
<p>Now we can express the following general integral using the function value from
either left (<span class="math">\(f(a)\)</span>) or right (<span class="math">\(f(a+h)\)</span>) hand side of the interval <span class="math">\(h\)</span>:</p>
<div class="math">
\[\int_a^{a+h} f(t) \,\d t
    = \int_0^h f(a+t) \,\d t
    = \int_0^h (1-\nabla_h)^{-{t\over h}} f(a) \,\d t
    =\]\[    = - {h\nabla_h\over (1-\nabla_h) \log(1-\nabla_h)}f(a) =\]\[    = h \left(1+\half\nabla_h + {5\over 12}\nabla_h^2+{3\over8}
        \nabla_h^3+\cdots\right) f(a) =\]\[    = - {h\nabla_h\over \log(1-\nabla_h)} (1-\nabla_h)^{-1}f(a)
    = - {h\nabla_h\over \log(1-\nabla_h)} f(a+h) =\]\[    = h \left(1-\half\nabla_h - {1\over 12}\nabla_h^2-{1\over24}
        \nabla_h^3+\cdots\right) f(a+h)\]</div>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">var</span><span class="p">,</span> <span class="n">simplify</span><span class="p">,</span> <span class="n">integrate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;nabla t h&quot;</span><span class="p">)</span>
<span class="go">(nabla, t, h)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">nabla</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="o">/</span><span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simplify</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">h*nabla/(-log(1 - nabla) + nabla*log(1 - nabla))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="go">h + h*nabla/2 + 5*h*nabla**2/12 + 3*h*nabla**3/8 + 251*h*nabla**4/720 + O(nabla**5)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">nabla</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simplify</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
<span class="go">-h*nabla/log(1 - nabla)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span><span class="o">.</span><span class="n">series</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="go">h - h*nabla/2 - h*nabla**2/12 - h*nabla**3/24 - 19*h*nabla**4/720 + O(nabla**5)</span>
</pre></div>
</div>
<p>Keeping terms only to third-order, we obtain:</p>
<div class="math">
\[\int_a^{a+h} f(t) \,\d t
    = - {h\nabla_h\over (1-\nabla_h) \log(1-\nabla_h)}f(a)
    \approx h \left(1+\half\nabla_h + {5\over 12}\nabla_h^2+{3\over8}
        \nabla_h^3\right) f(a)
    =\]\[    = h f(a) + h\half\left(f(a)-f(a-h)\right)
        +h{5\over 12}\left(f(a)-2f(a-h)+f(a-2h)\right)+\]\[        +h{3\over8}\left(f(a)-3f(a-h)+3f(a-2h)-f(a-3h)\right)
    =\]\[    = h\left(1+\half+{5\over12}+{3\over8}\right)f(a)
      -h\left(\half+{2\cdot5\over12}+{3\cdot3\over8}\right)f(a-h) +\]\[      +h\left({5\over12}+{3\cdot3\over8}\right)f(a-2h)
      -h\left({3\over8}\right)f(a-3h)
    =\]\[    = h{55\over24}f(a) -h{59\over24}f(a-h) +
      h{37\over24}f(a-2h) -h{3\over8}f(a-3h)
    =\]\[    = {h\over24}\left(55f(a) -59f(a-h) + 37f(a-2h) -9f(a-3h)\right)\]</div>
<p>Similarly:</p>
<div class="math">
\[\int_a^{a+h} f(t) \,\d t
    = - {h\nabla_h\over\log(1-\nabla_h)}f(a+h)
    \approx h \left(1-\half\nabla_h - {1\over 12}\nabla_h^2-{1\over24}
        \nabla_h^3\right) f(a+h)
    =\]\[    = {h\over24}\left(9f(a+h) +19f(a) -5f(a-h) +f(a-2h)\right)\]</div>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">var</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;f0 f1 f2 f3&quot;</span><span class="p">)</span>
<span class="go">(f0, f1, f2, f3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nabla1</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">-</span> <span class="n">f1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nabla2</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">f1</span> <span class="o">+</span> <span class="n">f2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nabla3</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">f1</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">f2</span> <span class="o">-</span> <span class="n">f3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">24</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span> <span class="o">+</span> <span class="n">nabla1</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">nabla2</span><span class="o">/</span><span class="mi">12</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">nabla3</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
<span class="go">-59*f1 - 9*f3 + 37*f2 + 55*f0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">24</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span> <span class="o">-</span> <span class="n">nabla1</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">nabla2</span><span class="o">/</span><span class="mi">12</span> <span class="o">-</span> <span class="n">nabla3</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span>
<span class="go">f3 - 5*f2 + 9*f0 + 19*f1</span>
</pre></div>
</div>
</div>
<div class="section" id="integrating-ode">
<h2>Integrating ODE<a class="headerlink" href="#integrating-ode" title="Permalink to this headline">¶</a></h2>
<p>Set of linear ODEs can be written in the form:</p>
<div class="math" id="equation-ode_eq">
<span class="eqno">(1)</span>\[{\d y\over\d r} = G y\]</div>
<p>For example for the Schrödinger we have</p>
<div class="math">
\[\begin{split}y = \begin{pmatrix}
    P \\
    Q
    \end{pmatrix}\end{split}\]\[\begin{split}G = \begin{pmatrix}
    0 &amp; 1 \\
    -2(E-V) - {l(l+1)\over r^2} &amp; 0 \\
    \end{pmatrix}\end{split}\]</div>
<p>Now we need to choose a grid <span class="math">\(r = r(t)\)</span>, where <span class="math">\(t\)</span> is some uniform grid. For
example <span class="math">\(r = r_0 (e^t-1)\)</span>:</p>
<div class="math">
\[r_i = r_0 (e^{t_i} - 1)\]\[t_i = (i-1)h\]</div>
<p>where <span class="math">\(i = 1, 2, 3, \dots, N\)</span>. We also need the derivative, for the exampe
above we get:</p>
<div class="math">
\[{\d r\over\d t} = r_0 e^t\]</div>
<p>Now we substitute this into <a href="#equation-ode_eq">(1)</a>:</p>
<div class="math">
\[{\d y\over\d t} = {\d r\over\d t} G y\]</div>
<p>We can integrate this system from <span class="math">\(a\)</span> to <span class="math">\(a+h\)</span> on a uniform grid <span class="math">\(t_i\)</span>:</p>
<div class="math">
\[y(a+h) = y(a) + \int_a^{a+h} {\d r\over\d t} G y\,\d t
    = y(a) + \int_a^{a+h} f(t)\,\d t\]</div>
<p>where <span class="math">\(f(t) = {\d r\over\d t} G y\)</span> and we use some method to approximate the
integral, see the previous section.</p>
</div>
<div class="section" id="radial-poisson-equation">
<h2>Radial Poisson Equation<a class="headerlink" href="#radial-poisson-equation" title="Permalink to this headline">¶</a></h2>
<p>Radial Poisson equation is:</p>
<div class="math" id="equation-poisson-V">
<span class="eqno">(2)</span>\[V''(r) + {2\over r} V'(r) = -4\pi n(r)\]</div>
<p>The left hand side can be written as:</p>
<div class="math">
\[V'' + {2\over r} V'
    = {1\over r} \left(r V'' + 2V'\right)
    = {1\over r} \left(r V\right)''\]</div>
<p>So the Poisson equation can also be written as:</p>
<div class="math" id="equation-poisson-rV">
<span class="eqno">(3)</span>\[(rV)'' = -4\pi r\, n\]</div>
<p>Now we determine the values of <span class="math">\(V(0)\)</span>, <span class="math">\(V'(0)\)</span> and the behavior of
<span class="math">\(V(\infty)\)</span> and <span class="math">\(V'(\infty)\)</span>. The equation determines <span class="math">\(V\)</span> up to an
arbitrary constant, so we set <span class="math">\(V(\infty) = 0\)</span> and now the potential <span class="math">\(V\)</span> is
determined uniquely.</p>
<p>The 3D integral of the (number) density is equal to the total (numeric) charge, which is equal to <span class="math">\(Z\)</span> (number of electrons). We can then use the Poisson equation to rewrite the integral in terms of <span class="math">\(V\)</span>:</p>
<div class="math">
\[Z = \int n({\bf x}) \d^3 x
    = \int n(r) r^2\d\Omega\d r
    = \int_0^\infty 4\pi n(r) r^2\d r =\]\[    = -\int_0^\infty (rV)'' r\d r =\]\[    = \int_0^\infty (rV)'\d r - [(rV)'r]_0^\infty =\]\[    = [rV]_0^\infty - [(rV)'r]_0^\infty =\]\[    = [rV - (rV)'r]_0^\infty =\]\[    = -[V'r^2]_0^\infty =\]\[    = \lim_{r\to0} V'(r)r^2 -\lim_{r\to\infty} V'(r)r^2\]</div>
<p>Let</p>
<div class="math">
\[\lim_{r\to0} V'(r)r^2 = C\]</div>
<p>Then around <span class="math">\(r\to0\)</span> we get <span class="math">\(V'(r) = {C\over r^2}\)</span> and <span class="math">\(V(r) = -{C\over r}+D\)</span>
(for some constant <span class="math">\(D\)</span>). As such, <span class="math">\(C\)</span> is a point charge (delta function) at
the origin. From now on, we will assume no point charge, i.e. <span class="math">\(C=0\)</span>.</p>
<p>In the limit <span class="math">\(r\to\infty\)</span>, we get the equation:</p>
<div class="math">
\[V'(r) = -{Z-C\over r^2} = -{Z\over r^2}\]</div>
<p>by integrating (and requiring that <span class="math">\(V\)</span> vanished in infinity to get rid of the
integration constant), we get for <span class="math">\(r\to\infty\)</span>:</p>
<div class="math">
\[V(r) = {Z\over r}\]</div>
<p>Integrating <a href="#equation-poisson-rV">(3)</a> directly, we get:</p>
<div class="math">
\[[(rV)']_0^\infty = -4\pi\int_0^\infty r n(r) \d r\]\[[V + rV']_0^\infty = -4\pi\int_0^\infty r n(r) \d r\]</div>
<p>We already know that <span class="math">\(V'\)</span> behaves like <span class="math">\(-{Z\over r^2}\)</span> in infinity,
so <span class="math">\(rV'\)</span> vanishes. Requiring <span class="math">\(V\)</span> itself to
vanish in infinity, the left hand side simplifies to <span class="math">\(-V(0)\)</span> and we get:</p>
<div class="math">
\[V(0) = 4\pi\int_0^\infty r n(r) \d r\]</div>
<p>Last thing to determine is <span class="math">\(V'(0)\)</span>. To do that, we expand the charge density
and potential (and it&#8217;s derivatives) into a series around the origin:</p>
<div class="math">
\[n(r) = n_0 + n_1 r + n_2 r^2 + \cdots = \sum_{k=0}^\infty n_k r^k\]\[V(r) = V_0 + V_1 r + V_2 r^2 + \cdots = \sum_{k=0}^\infty V_k r^k\]\[V'(r) = \sum_{k=1}^\infty V_k k r^{k-1}\]\[V''(r) = \sum_{k=2}^\infty V_k k(k-1) r^{k-2}\]</div>
<p>And substitute into the equation <a href="#equation-poisson-V">(2)</a>:</p>
<div class="math">
\[\sum_{k=2}^\infty V_k k(k-1) r^{k-2} +
    {2\over r}\sum_{k=1}^\infty V_k k r^{k-1} =
    -4\pi \sum_{k=0}^\infty n_k r^k\]\[\sum_{k=2}^\infty V_k k(k-1) r^{k-2} + {2\over r} V_1 +
    {2\over r}\sum_{k=2}^\infty V_k k r^{k-1} =
    -4\pi \sum_{k=0}^\infty n_k r^k\]\[\sum_{k=2}^\infty V_k k(k-1) r^{k-2} + {2\over r} V_1 +
    \sum_{k=2}^\infty 2V_k k r^{k-2} =
    -4\pi \sum_{k=0}^\infty n_k r^k\]\[{2\over r} V_1 +
    \sum_{k=2}^\infty V_k k\left((k-1) +2\right)r^{k-2}
    =
    -4\pi \sum_{k=0}^\infty n_k r^k\]\[{2\over r} V_1 +
    \sum_{k=2}^\infty V_k k(k+1)r^{k-2}
    =
    -4\pi \sum_{k=0}^\infty n_k r^k\]\[{2\over r} V_1 +
    \sum_{l=0}^\infty V_{l+2} (l+2)(l+3)r^l
    =
    -4\pi \sum_{k=0}^\infty n_k r^k\]\[{2\over r} V_1
    =
    -\sum_{k=0}^\infty \left(4\pi n_k+V_{k+2} (k+2)(k+3)\right) r^k\]</div>
<p>We now multiply the whole equation by <span class="math">\(r\)</span> and then set <span class="math">\(r=0\)</span>. We get
<span class="math">\(V_1 = 0\)</span>, so <span class="math">\(V'(0) = V_1 = 0\)</span>. We put it back into the equation to get:</p>
<div class="math">
\[\sum_{k=0}^\infty \left(4\pi n_k+V_{k+2} (k+2)(k+3)\right) r^k = 0\]</div>
<p>This must hold for all <span class="math">\(r\)</span>, so we get the following set of equations for <span class="math">\(k=0,
1, \cdots\)</span>:</p>
<div class="math">
\[4\pi n_k+V_{k+2} (k+2)(k+3) = 0\]</div>
<p>from which we express <span class="math">\(V_k\)</span> for all <span class="math">\(k \ge 2\)</span>.
We already know the values for <span class="math">\(k=1\)</span> and
<span class="math">\(k=0\)</span> from earlier, so overall we get:</p>
<div class="math">
\[V_0 = 4\pi\int_0^\infty r n(r) \d r\]\[V_1 = 0\]\[V_{k+2} = -{4\pi n_k\over (k+2)(k+3)}\]</div>
<p>in particular:</p>
<div class="math">
\[V_2 = - {4\pi n_0\over 6} = -{2\pi\over 3} n_0\]\[V_3 = - {4\pi n_1\over 12} = -{\pi\over 3} n_1\]\[V_4 = - {4\pi n_2\over 20} = -{\pi\over 5} n_2\]\[V_5 = - {4\pi n_3\over 30} = -{2\pi\over 15} n_3\]\[\cdots\]</div>
<p>So we get the following series expansion for <span class="math">\(V\)</span> and <span class="math">\(V'\)</span>:</p>
<div class="math">
\[V = V_0 -{2\pi\over 3} n_0 r^2 -{\pi\over 3} n_1 r^3-{\pi\over 5} n_2 r^4
    -{2\pi\over 15} n_3 r^5 - \cdots\]\[V' = -{4\pi\over 3} n_0 r -\pi n_1 r^2-{4\pi\over 5} n_2 r^3
    -{2\pi\over 3} n_3 r^4 - \cdots\]</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>It is useful to have analytic solutions to test the numerical solvers. Here we
present a few.</p>
<div class="section" id="gaussian-charge">
<h4>Gaussian Charge<a class="headerlink" href="#gaussian-charge" title="Permalink to this headline">¶</a></h4>
<p>The Gaussian charge is simply a Gaussian, normalized in such a way that the
total charge is <span class="math">\(Z\)</span>:</p>
<div class="math" id="equation-gauss_charge">
<span class="eqno">(4)</span>\[n(r) = {Z\alpha^3 \over \pi^{3\over2} } e^{-\alpha^2 r^2}\]</div>
<p>Let us verify the normalization by calculating the total charge <span class="math">\(Q\)</span>:</p>
<div class="math">
\[Q = \int n({\bf x}) \d^3 x
    = 4\pi \int_0^\infty n(r) r^2 \d r =\]\[= 4\pi \int_0^\infty {Z\alpha^3 \over \pi^{3\over2} } e^{-\alpha^2 r^2}
    r^2 \d r =\]\[= {4 Z \alpha^3 \over \sqrt\pi} \int_0^\infty e^{-\alpha^2 r^2} r^2 \d r =\]\[= {4 Z \alpha^3 \over \sqrt\pi} {\sqrt\pi\over 4\alpha^3} = Z\]</div>
<p>So the total charge is <span class="math">\(Q=Z\)</span>, as expected. Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">var</span><span class="p">,</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">oo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="go">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alpha</span><span class="o">=</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrate</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">))</span>
<span class="go">sqrt(pi)/(4*alpha**3)</span>
</pre></div>
</div>
<p>Now we calculate the potential <span class="math">\(V(r)\)</span> from the Poisson equation
<a href="#equation-poisson-rV">(3)</a>:</p>
<div class="math">
\[\left(rV(r)\right)'' = -4\pi r n(r)
    = -{4\alpha^3 r Z\over \sqrt\pi } e^{-\alpha^2 r^2}\]\[\left(rV(r)\right)' = {2 Z\alpha\over \sqrt\pi } e^{-\alpha^2 r^2} + A\]\[r V(r) = Z \,\mbox{erf}(\alpha r) + Ar + B\]\[V(r) = Z \,{\mbox{erf}(\alpha r) \over r} + A + {B\over r}\]</div>
<p>We have two integration constants <span class="math">\(A\)</span> and <span class="math">\(B\)</span>. We fix the potential using the
condition <span class="math">\(V(\infty) = 0\)</span>, which implies <span class="math">\(A=0\)</span>. The other constant <span class="math">\(B\)</span> is a
point charge at the origin, which in our case <a href="#equation-gauss_charge">(4)</a> is zero, so
<span class="math">\(B=0\)</span>.</p>
<p>We finally obtain the potential:</p>
<div class="math">
\[V(r) = Z \,{\mbox{erf}(\alpha r) \over r}\]</div>
<p>We can calculate the electrostatic self-energy, i.e. the energy of
interaction of the charge <span class="math">\(n(r)\)</span> with the potential generated by this
charge <span class="math">\(V(r)\)</span>:</p>
<div class="math">
\[E_\mathrm{self} =
\half \int n({\bf x}) V({\bf x}) \d^3 x
    = {4\pi\over2} \int_0^\infty n(r) V(r) r^2 \d r =\]\[= 2\pi \int_0^\infty {Z\alpha^3 \over \pi^{3\over2} } e^{-\alpha^2 r^2}
    Z \,{\mbox{erf}(\alpha r) \over r} r^2 \d r =\]\[= {2 Z^2 \alpha^3 \over \sqrt\pi}
    \int_0^\infty e^{-\alpha^2 r^2} \mbox{erf}(\alpha r) r \d r =\]\[= {2 Z^2 \alpha^3 \over \sqrt\pi} {\sqrt 2 \over 4\alpha^2} =\]\[= {Z^2 \alpha\over \sqrt{2\pi}}\]</div>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">var</span><span class="p">,</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="n">erf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="go">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alpha</span><span class="o">=</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrate</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">erf</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">))</span>
<span class="go">sqrt(2)/(4*alpha**2)</span>
</pre></div>
</div>
</div>
<div class="section" id="exponential-charge">
<h4>Exponential Charge<a class="headerlink" href="#exponential-charge" title="Permalink to this headline">¶</a></h4>
<p>The exponential charge is simply an exponential, normalized in such a way that
the total charge is <span class="math">\(Z\)</span>:</p>
<div class="math" id="equation-exp_charge">
<span class="eqno">(5)</span>\[n(r) = {Z\alpha^3 \over 8\pi} e^{-\alpha r}\]</div>
<p>Let us verify the normalization by calculating the total charge <span class="math">\(Q\)</span>:</p>
<div class="math">
\[Q = \int n({\bf x}) \d^3 x
    = 4\pi \int_0^\infty n(r) r^2 \d r =\]\[= 4\pi \int_0^\infty {Z\alpha^3 \over 8\pi} e^{-\alpha r}
    r^2 \d r =\]\[= {Z \alpha^3 \over 2} \int_0^\infty e^{-\alpha r} r^2 \d r =\]\[= {Z \alpha^3 \over 2} {2\over\alpha^3} = Z\]</div>
<p>So the total charge is <span class="math">\(Q=Z\)</span>, as expected.</p>
<p>Now we calculate the potential <span class="math">\(V(r)\)</span> from the Poisson equation
<a href="#equation-poisson-rV">(3)</a>:</p>
<div class="math">
\[\left(rV(r)\right)'' = -4\pi r n(r)
    = -{Z\alpha^3 \over 2} r e^{-\alpha r}\]\[V(r) = - Z \left({\alpha\over2} + {1\over r}\right) e^{-\alpha r} + A + {B\over r}\]</div>
<p>Similarly as for the Gaussian charge, we require the potential <span class="math">\(V(r)\)</span> to vanish
at infinity, which implies <span class="math">\(A=0\)</span>. Then we calculate the point charge at the
origin:</p>
<div class="math">
\[C = \lim_{r\to0} V'(r)r^2 =\]\[= \lim_{r\to0}
\half \left(- 2 B e^{\alpha r} + Z \alpha r \left(\alpha r + 1\right)
+ Z \left(\alpha r + 2\right)\right) e^{- \alpha r} =\]\[= Z - B\]</div>
<p>We do not have any point charge at the origin, so <span class="math">\(C=Z - B = 0\)</span>, from which it
follows <span class="math">\(B = Z\)</span>. We finally obtain:</p>
<div class="math">
\[V(r) = - Z \left({\alpha\over2} + {1\over r}\right) e^{-\alpha r}
    + {Z \over r}
    = Z \left({1-e^{-\alpha r} \over r} - {\alpha e^{-\alpha r}
        \over 2}\right)\]</div>
<p>Let us calculate the self-energy:</p>
<div class="math">
\[E_\mathrm{self} =
\half \int n({\bf x}) V({\bf x}) \d^3 x
    = {4\pi\over2} \int_0^\infty n(r) V(r) r^2 \d r =\]\[= 2\pi \int_0^\infty
{Z\alpha^3 \over 8\pi} e^{-\alpha r}
Z \left({1-e^{-\alpha r} \over r} - {\alpha e^{-\alpha r}
        \over 2}\right)
r^2 \d r =\]\[= {Z^2 \alpha^3 \over 4}
    \int_0^\infty e^{-\alpha r}
   \left({1-e^{-\alpha r} \over r} - {\alpha e^{-\alpha r}
        \over 2}\right)
    r^2 \d r =\]\[= {Z^2 \alpha^3 \over 4}
    \left({5\over 8\alpha^2}\right) =\]\[= {5Z^2 \alpha \over 32}\]</div>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">var</span><span class="p">,</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">oo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;r Z B&quot;</span><span class="p">)</span>
<span class="go">(r, Z, B)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alpha</span><span class="o">=</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrate</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">))</span>
<span class="go">2/alpha**3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="o">-</span><span class="n">Z</span><span class="o">*</span><span class="n">alpha</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">r</span><span class="p">),</span> <span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="n">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="go">-Z*(alpha*r + 2)*exp(-alpha*r)/(2*r)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">((</span><span class="n">V</span><span class="o">+</span><span class="n">B</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="go">(-2*B*exp(alpha*r) + Z*alpha*r*(alpha*r + 1) + Z*(alpha*r +</span>
<span class="go">2))*exp(-alpha*r)/2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">((</span><span class="n">V</span><span class="o">+</span><span class="n">B</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">-B + Z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrate</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">r</span><span class="p">))</span><span class="o">/</span><span class="n">r</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">))</span>
<span class="go">5/(8*alpha**2)</span>
</pre></div>
</div>
</div>
<div class="section" id="piecewise-polynomial-charge">
<h4>Piecewise Polynomial Charge<a class="headerlink" href="#piecewise-polynomial-charge" title="Permalink to this headline">¶</a></h4>
<p>We will use a second-derivative continuous piecewise polynomial for <span class="math">\(n(r)\)</span>,
normalized in such a way that the total charge is <span class="math">\(Z\)</span>:</p>
<div class="math" id="equation-poly_charge">
<span class="eqno">(6)</span>\[\begin{split}n(r) = \begin{cases}
-21Z(r-r_c)^3(6r^2+3rr_c+r_c^2)/(5\pi r_c^8) &amp;\quad\mbox{for $0\le r \le r_c$}\cr
0&amp;\quad\mbox{for $r&gt;r_c$}\cr
\end{cases}\end{split}\]</div>
<p>Let us verify the normalization by calculating the total charge <span class="math">\(Q\)</span>:</p>
<div class="math">
\[Q = \int n({\bf x}) \d^3 x
    = 4\pi \int_0^\infty n(r) r^2 \d r =\]\[= 4\pi \int_0^{r_c} -21Z(r-r_c)^3(6r^2+3rr_c+r_c^2)/(5\pi r_c^8)
    r^2 \d r =\]\[= Z\]</div>
<p>So the total charge is <span class="math">\(Q=Z\)</span>, as expected.</p>
<p>Now we calculate the potential <span class="math">\(V(r)\)</span> from the Poisson equation
<a href="#equation-poisson-rV">(3)</a>:</p>
<div class="math">
\[\left(rV(r)\right)'' = -4\pi r n(r)
    = 4\pi r \cdot 21Z(r-r_c)^3(6r^2+3rr_c+r_c^2)/(5\pi r_c^8)\]\[\begin{split}V(r) = \begin{cases}
\frac{Z r^{2}}{5 r_{c}^{8}} \left(9 r^{5} - 30 r^{4} r_{c} + 28
r^{3} r_{c}^{2} - 14 r_{c}^{5}\right) + A_1 + {B_1\over r}
&amp;\quad\mbox{for $0\le r \le r_c$}\cr
A_2 + {B_2\over r}&amp;\quad\mbox{for $r&gt;r_c$}\cr
\end{cases}\end{split}\]</div>
<p>Similarly as for the Gaussian charge, we require the potential <span class="math">\(V(r)\)</span> to vanish
at infinity, which implies <span class="math">\(A_2=0\)</span>. Then we calculate the point charge at the
origin:</p>
<div class="math">
\[C = \lim_{r\to0} V'(r)r^2 =\]\[= \lim_{r\to0}\left(
- B_1 + \frac{63 Z r^{8}}{5 r_{c}^{8}} - \frac{36 Z}{r_{c}^{7}} r^{7} +
  \frac{28 Z}{r_{c}^{6}} r^{6} - \frac{28 Z r^{3}}{5 r_{c}^{3}}
  \right)\]\[= -B_1\]</div>
<p>We do not have any point charge at the origin, so <span class="math">\(C=-B_1 = 0\)</span>, from which it
follows <span class="math">\(B_1 = 0\)</span>. Then <span class="math">\(B_2\)</span> is calculated from the condition of a continuous
first derivative at <span class="math">\(r=r_c\)</span>:</p>
<div class="math">
\[\begin{split}V'(r_c) = \begin{cases}
-{Z\over r_c^2} &amp;\quad\mbox{for $0\le r \le r_c$}\cr
-{B_2\over r_c^2}&amp;\quad\mbox{for $r&gt;r_c$}\cr
\end{cases}\end{split}\]</div>
<p>So <span class="math">\(B_2=Z\)</span>. Finally, <span class="math">\(A_1\)</span> is calculated from the continuous
values of <span class="math">\(V(r_c)\)</span>:</p>
<div class="math">
\[\begin{split}V(r_c) = \begin{cases}
A_1-{7Z\over 5r_c} &amp;\quad\mbox{for $0\le r \le r_c$}\cr
{Z\over r_c}&amp;\quad\mbox{for $r&gt;r_c$}\cr
\end{cases}\end{split}\]</div>
<p>which implies <span class="math">\(A_1={12Z\over 5r_c}\)</span>. We finally obtain:</p>
<div class="math">
\[\begin{split}V(r) = \begin{cases}
\frac{Z}{5 r_{c}^{8}} \left(9r^7 - 30r^6r_c + 28r^5r_c^2 - 14r^2r_c^5
    + 12 r_c^7\right) &amp;\quad\mbox{for $0\le r \le r_c$}\cr
{Z\over r}&amp;\quad\mbox{for $r&gt;r_c$}\cr
\end{cases}\end{split}\]</div>
<p>Let us calculate the self-energy:</p>
<div class="math">
\[E_\mathrm{self} =
\half \int n({\bf x}) V({\bf x}) \d^3 x
    = {4\pi\over2} \int_0^\infty n(r) V(r) r^2 \d r =\]\[= 2\pi \int_0^{r_c}
-21Z(r-r_c)^3(6r^2+3rr_c+r_c^2)/(5\pi r_c^8)
\frac{Z}{5 r_{c}^{8}} \left(9r^7 - 30r^6r_c + 28r^5r_c^2 - 14r^2r_c^5
    + 12 r_c^7\right)
r^2 \d r =\]\[= {15962 Z^2 \over 17875 r_c}\]</div>
<p>Let us also calculate the following integral:</p>
<div class="math">
\[I_g =
\int n({\bf x}) \left({Z\over r}-V({\bf x})\right) \d^3 x
    = 4\pi \int_0^\infty n(r) \left({Z\over r}-V(r)\right) r^2 \d r =\]\[= {10976 Z^2 \over 17875 r_c}\]</div>
<p>Which agrees with <a class="reference internal" href="#pask2012" id="id1">[Pask2012]</a>, equation (10c). The following integral over the
sphere of radius <span class="math">\(r_c\)</span>:</p>
<div class="math">
\[\begin{split}I_{sph} =
\int_{\Omega: r &lt; r_c} \left({Z\over r}-V({\bf x})\right) \d^3 x
    = 4\pi \int_0^{r_c} \left({Z\over r}-V(r)\right) r^2 \d r =\end{split}\]\[= {14 \pi Z r_c^2 \over 75}\]</div>
<p>Again in agreement with <a class="reference internal" href="#pask2012" id="id2">[Pask2012]</a>, the paragraph after equation (17).</p>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">var</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">solve</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;r r_c Z A B&quot;</span><span class="p">)</span>
<span class="go">(r, r_c, Z, A, B)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">21</span><span class="o">*</span><span class="n">Z</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">r_c</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">r_c</span><span class="o">+</span><span class="n">r_c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span> <span class="n">r_c</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">integrate</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r_c</span><span class="p">))</span>
<span class="go">Z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="n">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="go">Z*r**2*(9*r**5 - 30*r**4*r_c + 28*r**3*r_c**2 - 14*r_c**5)/(5*r_c**8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">((</span><span class="n">V</span><span class="o">+</span><span class="n">A</span><span class="o">+</span><span class="n">B</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="go">-B + 63*Z*r**8/(5*r_c**8) - 36*Z*r**7/r_c**7 + 28*Z*r**6/r_c**6 - 28*Z*r**3/(5*r_c**3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">V</span><span class="o">+</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_c</span><span class="p">)</span>
<span class="go">-Z/r_c**2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">V</span><span class="o">+</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_c</span><span class="p">)</span>
<span class="go">A - 7*Z/(5*r_c)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">solve</span><span class="p">((</span><span class="n">V</span><span class="o">+</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_c</span><span class="p">)</span><span class="o">-</span><span class="n">Z</span><span class="o">/</span><span class="n">r_c</span><span class="p">,</span> <span class="n">A</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span>
<span class="go">12*Z/(5*r_c)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="go">Z*(r**2*(9*r**5 - 30*r**4*r_c + 28*r**3*r_c**2 - 14*r_c**5) + 12*r_c**7)/(5*r_c**8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">integrate</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">V</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r_c</span><span class="p">))</span>
<span class="go">15962*Z**2/(17875*r_c)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">integrate</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">Z</span><span class="o">/</span><span class="n">r</span><span class="o">-</span><span class="n">V</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r_c</span><span class="p">))</span>
<span class="go">10976*Z**2/(17875*r_c)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">integrate</span><span class="p">((</span><span class="n">Z</span><span class="o">/</span><span class="n">r</span><span class="o">-</span><span class="n">V</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r_c</span><span class="p">))</span>
<span class="go">14*pi*Z*r_c**2/75</span>
</pre></div>
</div>
<p>Alternatively, one can also calculate this using a <tt class="docutils literal"><span class="pre">Piecewise</span></tt> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">var</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">solve</span><span class="p">,</span> <span class="n">Piecewise</span><span class="p">,</span> <span class="n">oo</span><span class="p">,</span> <span class="n">Symbol</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;r Z A B&quot;</span><span class="p">)</span>
<span class="go">(r, Z, A, B)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r_c</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;r_c&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="n">Piecewise</span><span class="p">((</span><span class="o">-</span><span class="mi">21</span><span class="o">*</span><span class="n">Z</span><span class="o">*</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">r_c</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">r_c</span> <span class="o">+</span> <span class="n">r_c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">r_c</span><span class="o">**</span><span class="mi">8</span><span class="p">),</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r_c</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">integrate</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">))</span>
<span class="go">Z</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span> <span class="o">=</span> <span class="n">integrate</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="n">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="go">Piecewise((Z*r**2*(9*r**5 - 30*r**4*r_c + 28*r**3*r_c**2 - 14*r_c**5)/(5*r_c**8), r &lt;= r_c), (0, True))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">((</span><span class="n">V</span><span class="o">+</span><span class="n">A</span><span class="o">+</span><span class="n">B</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="go">Piecewise((-B + 63*Z*r**8/(5*r_c**8) - 36*Z*r**7/r_c**7 + 28*Z*r**6/r_c**6 - 28*Z*r**3/(5*r_c**3), r &lt;= r_c), (-B, True))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">V</span><span class="o">+</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_c</span><span class="p">)</span>
<span class="go">-Z/r_c**2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">V</span><span class="o">+</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_c</span><span class="p">)</span>
<span class="go">A - 7*Z/(5*r_c)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">solve</span><span class="p">((</span><span class="n">V</span><span class="o">+</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r_c</span><span class="p">)</span><span class="o">-</span><span class="n">Z</span><span class="o">/</span><span class="n">r_c</span><span class="p">,</span> <span class="n">A</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span>
<span class="go">12*Z/(5*r_c)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">+</span> <span class="n">Piecewise</span><span class="p">((</span><span class="n">A</span><span class="p">,</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">r_c</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="go">Piecewise((Z*(r**2*(9*r**5 - 30*r**4*r_c + 28*r**3*r_c**2 - 14*r_c**5)/r_c**7 + 12)/(5*r_c), r &lt;= r_c), (0, True))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">integrate</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">V</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">))</span>
<span class="go">15962*Z**2/(17875*r_c)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">integrate</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">Z</span><span class="o">/</span><span class="n">r</span><span class="o">-</span><span class="n">V</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oo</span><span class="p">))</span>
<span class="go">10976*Z**2/(17875*r_c)</span>
</pre></div>
</div>
<table class="docutils citation" frame="void" id="pask2012" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[Pask2012]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>)</em> Pask, J. E., Sukumar, N., Mousavi, S. E. (2012). Linear scaling solution of the all-electron Coulomb problem in solids. International Journal for Multiscale Computational Engineering, 10(1), 83–99.  doi:10.1615/IntJMultCompEng.2011002201</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Ordinary Differential Equations</a><ul>
<li><a class="reference internal" href="#finite-difference-formulas">Finite Difference Formulas</a></li>
<li><a class="reference internal" href="#integrating-ode">Integrating ODE</a></li>
<li><a class="reference internal" href="#radial-poisson-equation">Radial Poisson Equation</a><ul>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#gaussian-charge">Gaussian Charge</a></li>
<li><a class="reference internal" href="#exponential-charge">Exponential Charge</a></li>
<li><a class="reference internal" href="#piecewise-polynomial-charge">Piecewise Polynomial Charge</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="wigner.html"
                        title="previous chapter">Wigner D Function</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="la.html"
                        title="next chapter">Linear Algebra</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/math/ode.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="la.html" title="Linear Algebra"
             >next</a> |</li>
        <li class="right" >
          <a href="wigner.html" title="Wigner D Function"
             >previous</a> |</li>
        <li><a href="../index.html">Theoretical Physics Reference 0.5 documentation</a> &raquo;</li>
          <li><a href="main.html" >Mathematics</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2011, Ondřej Čertík.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>