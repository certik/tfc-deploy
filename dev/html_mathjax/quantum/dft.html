<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Density Functional Theory (DFT) &mdash; Theoretical Physics Reference 0.5 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Theoretical Physics Reference 0.5 documentation" href="../index.html" />
    <link rel="up" title="Quantum Field Theory and Quantum Mechanics" href="main.html" />
    <link rel="next" title="Hartree-Fock (HF) Method" href="hf.html" />
    <link rel="prev" title="Radial Schrödinger and Dirac Equations" href="radial.html" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28893880-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
     

  </head>
  <body>
    <div style="display:none">
    \(
        \newcommand{\d}{\mathrm{d}}
        \newcommand{\bomega}{\vec\omega}
        \newcommand{\half}{ {1\over 2} }
        \def\mathnot#1{\text{"$#1$"}}

        %operators
        \newcommand{\diag}{\mathrm{diag}}
        \newcommand{\sinc}{\mathrm{sinc}}
        \newcommand{\Sh}{ {\large\style{font-family:Times}{\text{Ш}}} }
        \newcommand{\res}{\mathrm{Res}}
    \)
    </div>
    

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="hf.html" title="Hartree-Fock (HF) Method"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="radial.html" title="Radial Schrödinger and Dirac Equations"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Theoretical Physics Reference 0.5 documentation</a> &raquo;</li>
          <li><a href="main.html" accesskey="U">Quantum Field Theory and Quantum Mechanics</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="density-functional-theory-dft">
<h1>Density Functional Theory (DFT)<a class="headerlink" href="#density-functional-theory-dft" title="Permalink to this headline">¶</a></h1>
<div class="section" id="many-body-schrodinger-equation">
<h2>Many Body Schrödinger Equation<a class="headerlink" href="#many-body-schrodinger-equation" title="Permalink to this headline">¶</a></h2>
<p>We use (Hartree) atomic units in this whole section about DFT.
We use the Born-Oppenheimer approximation, which says that the nuclei of the
treated atoms are seen as fixed. A stationary electronic state (for <span class="math">\(N\)</span>
electrons) is then described by a wave function
<span class="math">\(\Psi({\bf r_1},{\bf r_2},\cdots,{\bf r}_N)\)</span>
fulfilling the many-body Schrödinger equation</p>
<div class="math">
\[\hat H\ket\Psi=(\hat T+\hat U+\hat V)\ket\Psi=E\ket\Psi\]</div>
<p>where</p>
<div class="math">
\[\hat T = \sum_i^N -{1\over2}\nabla_i^2\]</div>
<p>is the kinetic term,</p>
<div class="math">
\[\begin{split}\hat U = \sum_{i&lt;j}U({\bf r_i},{\bf r_j})= {1\over2}\sum_{i,j}U({\bf r_i},{\bf r_j})\end{split}\]\[U({\bf r_i},{\bf r_j})=U({\bf r_j},{\bf r_i})={1\over|{\bf r_i}-{\bf r_j}|}\]</div>
<p>is the electron-electron interaction term and</p>
<div class="math">
\[\hat V = \sum_i^N v({\bf r_i})\]\[v({\bf r_i})=\sum_k -{Z_k\over|{\bf r_i}-{\bf R_k}|}\]</div>
<p>is the interaction term between electrons and nuclei, where <span class="math">\(R_k\)</span> are positions
of nuclei and <span class="math">\(Z_k\)</span> the number of nucleons in each nucleus (we are using atomic
units). So for one atomic calculation with the atom nucleus in the origin, we
have just <span class="math">\(v({\bf r_i})=-{Z\over|{\bf r_i}|}\)</span>.</p>
<p><span class="math">\(|\Psi|^2=\Psi^*\Psi\)</span> gives the probability density of measuring the first
electron at the position <span class="math">\(\bf r_1\)</span>, the second at <span class="math">\(\bf r_2\)</span>, dots and the Nth
electron at the position <span class="math">\({\bf r}_N\)</span>. The normalization is such that
<span class="math">\(\int|\Phi|^2\d^3 r_1\d^3 r_2\dots\d^3 r_N=1\)</span>. The <span class="math">\(\Psi\)</span> is antisymmetric,
i.e.  <span class="math">\(\Psi({\bf r_1},{\bf r_2},\cdots,{\bf r}_N)= -\Psi({\bf r_2},{\bf
r_1},\cdots,{\bf r}_N)= -\Psi({\bf r_1},{\bf r}_N,\cdots,{\bf r_2})\)</span> etc.</p>
<p>Integrating <span class="math">\(|\Psi|^2\)</span> over the first <span class="math">\(N-1\)</span> electrons is the probability
density that the <span class="math">\(N\)</span>-th electron is at the position <span class="math">\({\bf r}_N\)</span>. Thus the
probability density <span class="math">\(n({\bf r})\)</span> that any of the N electrons (i.e the first, or
the second, or the third, dots, or the <span class="math">\(N\)</span>-th) is at the position <span class="math">\(\bf r\)</span> is
called the particle (or number) density and is therefore given by:</p>
<div class="math">
\[n({\bf r})= \int \Psi^*({\bf r},{\bf r}_2,\cdots,{\bf r}_N) \Psi ({\bf r},{\bf r}_2,\cdots,{\bf r}_N) \,\d^3 r_2\,\d^3 r_3\cdots\d^3 r_N+\]\[+\int \Psi^*({\bf r}_1,{\bf r},\cdots,{\bf r}_N) \Psi ({\bf r}_1,{\bf r},\cdots,{\bf r}_N) \,\d^3 r_1\,\d^3 r_3\cdots\d^3 r_N+\cdots\]\[+\int \Psi^*({\bf r}_1,{\bf r}_2,\cdots,{\bf r}) \Psi ({\bf r}_1,{\bf r}_2,\cdots,{\bf r}) \,\d^3 r_1\,\d^3 r_2\,\d^3 r_3\cdots\d^3 r_{N-1}=\]\[=\int(\delta({\bf r}-{\bf r}_1)+\delta({\bf r}-{\bf r}_2)+\cdots+\delta({\bf r}-{\bf r}_N))\]\[\Psi^*({\bf r}_1,{\bf r}_2,\cdots,{\bf r}_N) \Psi ({\bf r}_1,{\bf r}_2,\cdots,{\bf r}_N) \,\d^3 r_1\,\d^3 r_2\,\d^3 r_3\cdots\d^3 r_{N}=\]\[=\sum_{i=1}^N\int \braket{\Psi|{\bf r}_1,{\bf r}_2,\cdots,{\bf r}_N}\delta({\bf r}-{\bf r}_i) \braket{{\bf r}_1,{\bf r}_2,\cdots,{\bf r}_N|\Psi} \,\d^3 r_1\,\d^3 r_2\,\d^3 r_3\cdots\d^3 r_{N}=\]\[=N\int \braket{\Psi|{\bf r}_1,{\bf r}_2,\cdots,{\bf r}_N}\delta({\bf r}-{\bf r}_1) \braket{{\bf r}_1,{\bf r}_2,\cdots,{\bf r}_N|\Psi} \,\d^3 r_1\,\d^3 r_2\,\d^3 r_3\cdots\d^3 r_{N}=\]</div>
<div class="math" id="equation-chargedensity">
<span class="eqno">(1)</span>\[=N\int \Psi^*({\bf r},{\bf r}_2,\cdots,{\bf r}_N) \Psi ({\bf r},{\bf r}_2,\cdots,{\bf r}_N) \,\d^3 r_2\,\d^3 r_3\cdots\d^3 r_N\]</div>
<p>Thus <span class="math">\(\int_\Omega n({\bf r})\,\d^3r\)</span> gives the number of particles
in the region of integration <span class="math">\(\Omega\)</span>. Obviously <span class="math">\(\int
n({\bf r})\,\d^3r=N\)</span>.</p>
<p>Note that the number density <span class="math">\(n({\bf r})\)</span> and potential <span class="math">\(V({\bf r})\)</span> in the
Schroedinger equation is related to the electron charge density <span class="math">\(\rho({\bf r})\)</span>
and electrostatic potential energy <span class="math">\(\phi({\bf r})\)</span> by:</p>
<div class="math">
\[\rho({\bf r}) = q n({\bf r})\]\[q\phi({\bf r}) = V({\bf r})\]</div>
<p>where <span class="math">\(q\)</span> is the particle elementary charge,
which for electrons is <span class="math">\(q=-e=-1\)</span> in atomic units.
The amount of electronic charge in the region <span class="math">\(\Omega\)</span> is given by:</p>
<div class="math">
\[Q
    = \int_\Omega \rho({\bf r})\,\d^3r
    = q\int_\Omega n({\bf r})\,\d^3r
    = -\int_\Omega n({\bf r})\,\d^3r\]</div>
<p>The energy of the system is given by</p>
<div class="math" id="equation-Emanybody">
<span class="eqno">(2)</span>\[E=\braket{\Psi|\hat H|\Psi}= \braket{\Psi|\hat T|\Psi}+\braket{\Psi|\hat U|\Psi}+\braket{\Psi|\hat V|\Psi}= T+U+V\]</div>
<p>where</p>
<div class="math">
\[T=\braket{\Psi|\hat T|\Psi}=\sum_i^N\int \Psi^*({\bf r_1},{\bf r_2},\cdots,{\bf r_N})(-\half\nabla_i^2) \Psi({\bf r_1},{\bf r_2},\cdots,{\bf r_N})\,\d^3 r_1\,\d^3 r_2\cdots\d^3 r_N\]\[U=\braket{\Psi|\hat U|\Psi}\]\[V=\braket{\Psi|\hat V|\Psi}=\sum_i^N\int \Psi^*({\bf r_1},{\bf r_2},\cdots,{\bf r_N})v({\bf r_i}) \Psi({\bf r_1},{\bf r_2},\cdots,{\bf r_N})\,\d^3 r_1\,\d^3 r_2\cdots\d^3 r_N=\]\[=\sum_i^N\int \Psi^*({\bf r_1},{\bf r_2},\cdots,{\bf r_N})v({\bf r_1}) \Psi({\bf r_1},{\bf r_2},\cdots,{\bf r_N})\,\d^3 r_1\,\d^3 r_2\cdots\d^3 r_N=\]\[=N\int \Psi^*({\bf r_1},{\bf r_2},\cdots,{\bf r_N})v({\bf r_1}) \Psi({\bf r_1},{\bf r_2},\cdots,{\bf r_N})\,\d^3 r_1\,\d^3 r_2\cdots\d^3 r_N=\]</div>
<div class="math" id="equation-V[n]">
<span class="eqno">(3)</span>\[=\int v({\bf r}) n({\bf r})\d^3 r=V[n]\]</div>
<p>It needs to be stressed, that <span class="math">\(E\)</span> generally is <em>not</em> a functional of <span class="math">\(n\)</span>
alone, only the <span class="math">\(V[n]\)</span> is. In the next section we show however, that if the
<span class="math">\(\ket{\Psi}\)</span> is a ground state (of any system), then <span class="math">\(E\)</span> becomes a functional
of <span class="math">\(n\)</span>.</p>
</div>
<div class="section" id="the-hohenberg-kohn-theorem">
<h2>The Hohenberg-Kohn Theorem<a class="headerlink" href="#the-hohenberg-kohn-theorem" title="Permalink to this headline">¶</a></h2>
<p>The Schrödinger equation gives the map</p>
<div class="math">
\[C: V \to \Psi\]</div>
<p>where <span class="math">\(\Psi\)</span> is the ground state. C is bijective (one-to-one correspondence),
because to every <span class="math">\(V\)</span> we can compute the corresponding <span class="math">\(\Psi\)</span> from Schrödinger
equation and two different <span class="math">\(V\)</span> and <span class="math">\(V'\)</span> (differing by more than a constant)
give two different <span class="math">\(\Psi\)</span>, because if <span class="math">\(V\)</span> and <span class="math">\(V'\)</span> gave the same <span class="math">\(\Psi\)</span>, then
by substracting</p>
<div class="math">
\[\hat H\ket{\Psi}=E_{gs}\ket{\Psi}\]</div>
<p>from</p>
<div class="math">
\[\hat H'\ket{\Psi}=(\hat H-\hat V+\hat V')\ket{\Psi}=E_{gs}'\ket{\Psi}\]</div>
<p>we would get <span class="math">\(V-V'=E-E'\)</span>, which is a contradiction with the assumption that <span class="math">\(V\)</span> and <span class="math">\(V'\)</span> differ by more than a constant.</p>
<p>Similarly, from the ground state wavefunction <span class="math">\(\Psi\)</span> we can compute the charge
density <span class="math">\(n\)</span> giving rise to the map</p>
<div class="math">
\[D: \Psi \to n\]</div>
<p>which is also bijective, because to every <span class="math">\(\Psi\)</span> we can compute <span class="math">\(n\)</span> from
<a href="#equation-chargedensity">(1)</a> and two different <span class="math">\(\Psi\)</span> and <span class="math">\(\Psi'\)</span> give two different
<span class="math">\(n\)</span> and <span class="math">\(n'\)</span>, because different <span class="math">\(\Psi\)</span> and <span class="math">\(\Psi'\)</span> give</p>
<div class="math">
\[\begin{split}E_{gs}=\braket{\Psi|\hat H|\Psi}&lt;\braket{\Psi'|\hat H|\Psi'}= \braket{\Psi'|\hat H'+\hat V-\hat V'|\Psi'}=E_{gs}'+\int n'({\bf r}) (v({\bf r})-v'({\bf r}))\,\d^3 r\end{split}\]\[\begin{split}E_{gs}'=\braket{\Psi'|\hat H'|\Psi'}&lt;\braket{\Psi|\hat H'|\Psi}= \braket{\Psi|\hat H+\hat V'-\hat V|\Psi}=E_{gs}+\int n({\bf r}) (v'({\bf r})-v({\bf r}))\,\d^3 r\end{split}\]</div>
<p>adding these two inequalities together gives</p>
<div class="math">
\[\begin{split}0&lt;\int n'({\bf r}) (v({\bf r})-v'({\bf r}))\,\d^3 r + \int n({\bf r}) (v'({\bf r})-v({\bf r}))\,\d^3 r= \int (n({\bf r})-n'({\bf r}))(v'({\bf r})-v({\bf r}))\,\d^3 r\end{split}\]</div>
<p>which for <span class="math">\(n=n'\)</span> gives <span class="math">\(0&lt;0\)</span>, which is nonsense, so <span class="math">\(n\neq n'\)</span>.</p>
<p>So we have proved that for a given ground state density <span class="math">\(n_0({\bf r})\)</span>
(generated by a potential <span class="math">\(\hat V_0\)</span>) it is possible to calculate the
corresponding ground state wavefunction <span class="math">\(\Psi_0({\bf r_1},{\bf r_2},\cdots,{\bf
r_N})\)</span>, in other words, <span class="math">\(\Psi_0\)</span> is a unique functional of <span class="math">\(n_0\)</span>:</p>
<div class="math">
\[\Psi_0=\Psi_0[n_0]\]</div>
<p>so the ground state energy <span class="math">\(E_0\)</span> is also a functional of <span class="math">\(n_0\)</span></p>
<div class="math">
\[E_0=\braket{\Psi_0[n_0]|\hat T+\hat U+\hat V_0|\Psi_0[n_0]}=E[n_0]\]</div>
<p>We define an energy functional</p>
<div class="math" id="equation-Efunct">
<span class="eqno">(4)</span>\[E_{v_0}[n]=\braket{\Psi[n]|\hat T+\hat U+\hat V_0|\Psi[n]}= \braket{\Psi[n]|\hat T+\hat U|\Psi[n]}+\int v_0({\bf r})n({\bf r})\d^3r\]</div>
<p>where <span class="math">\(\ket{\Psi[n]}\)</span> is any ground state wavefunction (generated by an
arbitrary potential), that is, <span class="math">\(n\)</span> is a ground state density belonging to an
arbitrary system. <span class="math">\(E_0\)</span> which is generated by the potential <span class="math">\(V_0\)</span> can then be
expressed as</p>
<div class="math">
\[E_0=E_{v_0}[n_0]\]</div>
<p>and for <span class="math">\(n\neq n_0\)</span> we have (from the Ritz principle)</p>
<div class="math">
\[\begin{split}E_0&lt;E_{v_0}[n]\end{split}\]</div>
<p>and one has to minimize the functional <span class="math">\(E_{v_0}[n]\)</span>:</p>
<div class="math" id="equation-Emin">
<span class="eqno">(5)</span>\[E_0=\min_n E_{v_0}[n]\]</div>
<p>The term</p>
<div class="math">
\[\braket{\Psi[n]|\hat T+\hat U|\Psi[n]}\equiv F[n]\]</div>
<p>in <a href="#equation-Efunct">(4)</a> is universal in the sense that it doesn&#8217;t depend on <span class="math">\(\hat
V_0\)</span>. It can be proven <a class="reference internal" href="#dft" id="id1">[DFT]</a>, that <span class="math">\(F[n]\)</span> is a functional of <span class="math">\(n\)</span> for
degenerated ground states too, so <a href="#equation-Emin">(5)</a> stays true as well.</p>
<p>The ground state densities in <a href="#equation-Efunct">(4)</a> and <a href="#equation-Emin">(5)</a> are called
<em>pure-state v-representable</em> because they are the densities of (possible
degenerate) ground state of the Hamiltonian with some local potential <span class="math">\(v({\bf
r})\)</span>. One may ask a question if all possible functions are v-representable
(this is called the v-representability problem). The question is relevant,
because we need to know which functions to take into account in the
minimization process <a href="#equation-Emin">(5)</a>. Even though not every function is
v-representable <a class="reference internal" href="#dft" id="id2">[DFT]</a>, every density defined on a grid (finite of
infinite) which is strictly positive, normalized and consistent with the Pauli
principle is ensemble v-representable. Ensemble v-representation is just a
simple generalization of the above, for details see <a class="reference internal" href="#dft" id="id3">[DFT]</a>.</p>
<p>The functional <span class="math">\(E_{v_0}[n]\)</span> in <a href="#equation-Emin">(5)</a> depends on the particle number <span class="math">\(N\)</span>,
so in order to get <span class="math">\(n\)</span>, we need to solve the variational formulation</p>
<div class="math">
\[{\delta\over\delta n}\left(E_v[n]-\mu(N)\int n(\bf r)\d^3r\right)=0\]</div>
<p>so</p>
<div class="math" id="equation-euler">
<span class="eqno">(6)</span>\[{\delta E_v[n]\over\delta n}=\mu(N)\]</div>
<p>Let the <span class="math">\(n_N(\bf r)\)</span> be the solution of <a href="#equation-euler">(6)</a> with a particle number
<span class="math">\(N\)</span> and the energy <span class="math">\(E_N\)</span>:</p>
<div class="math">
\[E_N=E_v[n_N]\]</div>
<p>The Lagrangian multiplier <span class="math">\(\mu\)</span> is the exact chemical potential of the system</p>
<div class="math">
\[\mu(N)={\partial E_N\over\partial N}\]</div>
<p>becuase</p>
<div class="math">
\[E_{N+\epsilon}-E_N=E_v[n_{N+\epsilon}]-E_v[n_N] =\int {\delta E_v\over\delta n} (n_{N+\epsilon}-n_N)\d^3r=\]\[=\int \mu(N) (n_{N+\epsilon}-n_N)\d^3r =\mu(N)(N+\epsilon-N)=\mu(N)\epsilon\]</div>
<p>so</p>
<div class="math">
\[\mu(N)={E_{N+\epsilon}-E_N\over\epsilon} \ \longrightarrow \ {\partial E_N\over\partial N}\]</div>
</div>
<div class="section" id="the-kohn-sham-equations">
<h2>The Kohn-Sham Equations<a class="headerlink" href="#the-kohn-sham-equations" title="Permalink to this headline">¶</a></h2>
<p>Consider an auxiliary system of <span class="math">\(N\)</span> noninteracting electrons (noninteracting
gas):</p>
<div class="math">
\[\hat H_s=\hat T+\hat V_s\]</div>
<p>the Schrödinger equation then becomes:</p>
<div class="math">
\[(-\half\nabla^2+v_s({\bf r}))\psi_i({\bf r}) =\epsilon_i\psi_i({\bf r})\]\[n_s({\bf r})=\sum_i^N|\psi_i({\bf r})|^2\]</div>
<p>and the total energy is:</p>
<div class="math">
\[E_s[n]=T_s[\{\psi_i[n]\}]+V_s[n]\]</div>
<p>where</p>
<div class="math">
\[T_s[n]=\braket{\Psi[n]|\hat T|\Psi[n]}= \sum_i\braket{\psi_i|-\half\nabla^2|\psi_i}\]\[V_s[n]=\braket{\Psi[n]|\hat V|\Psi[n]}=\int v_s({\bf r})n({\bf r})\d^3r\]</div>
<p>So:</p>
<div class="math">
\[E_s[n] = \sum_i\braket{\psi_i|-\half\nabla^2|\psi_i} +
    \int v_s({\bf r})n({\bf r})\d^3r
    =\]\[    = \sum_i\int \psi_i^* \left(-\half\nabla^2\right)\psi_i\,\d^3 r +
        \int v_s({\bf r})\sum_i\psi_i^* \psi_i\, \d^3r
    =\]\[    = \sum_i\int \psi_i^* \left(-\half\nabla^2 + v_s({\bf r})\right)
        \psi_i\,\d^3 r
    =\]\[    = \sum_i \epsilon_i\int \psi_i^* \psi_i\,\d^3 r =\]\[    = \sum_i \epsilon_i\]</div>
<p>The total energy is the sum of eigenvalues (energies of the individual
independent particles) as expected. From the last equation it follows:</p>
<div class="math">
\[T_s[n] = \sum_i\braket{\psi_i|-\half\nabla^2|\psi_i}
    = \sum_i \epsilon_i -\int v_s({\bf r})n({\bf r})\d^3r\]</div>
<p>In other words, the kinetic energy of the noninteracting particles is equal to
the sum of eigenvalues minus the potential energy coming from the total
effective potential <span class="math">\(v_s\)</span> used to construct the single particle orbitals
<span class="math">\(\psi_i\)</span>.</p>
<p>From <a href="#equation-euler">(6)</a> we get</p>
<div class="math" id="equation-noninteract">
<span class="eqno">(7)</span>\[\mu={\delta E_s[n]\over\delta n({\bf r})}= {\delta T_s[n]\over\delta n({\bf r})}+{\delta V_s[n]\over\delta n({\bf r})}= {\delta T_s[n]\over\delta n({\bf r})}+v_s({\bf r})\]</div>
<p>Solution to this equation gives the density <span class="math">\(n_s\)</span>.</p>
<p>Now we want to express the energy in <a href="#equation-Emanybody">(2)</a> using <span class="math">\(T_s\)</span> and <span class="math">\(E_H\)</span>
for convenience, where <span class="math">\(E_H\)</span> is the classical electrostatic interaction energy
of the charge distribution <span class="math">\(\rho({\bf r})\)</span>, defined using following relations
- we start with a Poisson equation in atomic units</p>
<div class="math">
\[\nabla^2 \phi_H({\bf r})=-4\pi \rho({\bf r})\]</div>
<p>and substitute <span class="math">\(\rho({\bf r}) = q n({\bf r})\)</span>,
<span class="math">\(V_H({\bf r}) = q \phi_H({\bf r})\)</span> and we use the fact that <span class="math">\(q^2=1\)</span> in atomic
units:</p>
<div class="math">
\[\nabla^2 V_H({\bf r})=-4\pi q^2 n({\bf r}) = -4\pi n({\bf r})\]</div>
<p>or equivalently by expressing <span class="math">\(V_H\)</span> using the Green function:</p>
<div class="math" id="equation-V_H">
<span class="eqno">(8)</span>\[V_H({\bf r})
    = -{1\over 4\pi} \int {-4\pi n({\bf r'})\over|{\bf r}-{\bf r'}|} \d^3r'
    = \int {n({\bf r'})\over|{\bf r}-{\bf r'}|} \d^3r'\]</div>
<p>and finally <span class="math">\(E_H\)</span> is related to <span class="math">\(V_H\)</span> using:</p>
<div class="math">
\[V_H({\bf r})={\delta E_H\over\delta n({\bf r})}\]</div>
<p>so we get:</p>
<div class="math">
\[E_H[n]=\half\int\int {n({\bf r})n({\bf r'})\over|{\bf r}-{\bf r'}|} \d^3r\d^3r'\]</div>
<p>Using the rules for functional differentiation, we can check that:</p>
<div class="math">
\[V_H({\bf r})
    ={\delta E_H\over\delta n({\bf r})}
    ={\delta \over\delta n({\bf r})}
        \half\int\int {n({\bf r'})n({\bf r''})\over|{\bf r'}-{\bf r''}|}
        \d^3r'\d^3r''
    =\]\[    =\int {n({\bf r'})\over|{\bf r}-{\bf r'}|}
        \d^3r'\]</div>
<p>Using the above relations, we can see that</p>
<div class="math">
\[E_H[n]=\half\int V_H({\bf r}) n({\bf r}) \d^3r\]</div>
<p>So from <a href="#equation-Efunct">(4)</a> we get</p>
<div class="math" id="equation-Efunctxc">
<span class="eqno">(9)</span>\[E[n]=(T+U)[n]+V[n]=T_s[n]+E_H[n]+(T-T_s+U-E_H)[n]+V[n]=\]\[=T_s[n]+E_H[n]+E_{xc}[n]+V[n]\]</div>
<p>The rest of the energy is denoted by <span class="math">\(E_{xc}=U-E_H+T-T_s\)</span> and it is called is
the exchange and correlation energy functional. From <a href="#equation-euler">(6)</a></p>
<div class="math">
\[\mu={\delta E[n]\over\delta n({\bf r})}= {\delta T_s[n]\over\delta n({\bf r})}+ {\delta E_H[n]\over\delta n({\bf r})}+ {\delta E_{xc}[n]\over\delta n({\bf r})}+ {\delta V[n]\over\delta n({\bf r})}\]</div>
<p>From <a href="#equation-V_H">(8)</a> we have</p>
<div class="math">
\[{\delta E_H\over\delta n({\bf r})}=V_H({\bf r})\]</div>
<p>from <a href="#equation-V[n]">(3)</a> we get</p>
<div class="math">
\[{\delta V[n]\over\delta n({\bf r})}=v({\bf r})\]</div>
<p>we define</p>
<div class="math" id="equation-Vxcpot">
<span class="eqno">(10)</span>\[{\delta E_{xc}[n]\over\delta n({\bf r})}=V_{xc}({\bf r})\]</div>
<p>so we arrive at</p>
<div class="math" id="equation-interact">
<span class="eqno">(11)</span>\[\mu={\delta E[n]\over\delta n({\bf r})}= {\delta T_s[n]\over\delta n({\bf r})}+V_H({\bf r})+V_{xc}({\bf r})+v({\bf r})\]</div>
<p>Solution to this equation gives the density <span class="math">\(n\)</span>. Comparing <a href="#equation-interact">(11)</a> to
<a href="#equation-noninteract">(7)</a> we see that if we choose</p>
<div class="math" id="equation-V_in">
<span class="eqno">(12)</span>\[v_s\equiv V_H+V_{xc}+v\]</div>
<p>then <span class="math">\(n_s({\bf r})\equiv n({\bf r})\)</span>. So we solve the Kohn-Sham equations of
this auxiliary non-interacting system</p>
<div class="math" id="equation-KSeq">
<span class="eqno">(13)</span>\[(-\half\nabla^2+v_s({\bf r}))\psi_i({\bf r}) \equiv(-\half\nabla^2+V_H({\bf
r})+V_{xc}({\bf r})+v({\bf r}))\psi_i({\bf r}) =\epsilon_i\psi_i({\bf r})\]</div>
<p>which yield the orbitals <span class="math">\(\psi_i\)</span> that reproduce the density <span class="math">\(n({\bf r})\)</span> of the original interacting system</p>
<div class="math" id="equation-KSdensity">
<span class="eqno">(14)</span>\[n({\bf r})\equiv n_s({\bf r})=\sum_i^N|\psi_i({\bf r})|^2\]</div>
<p>The sum is taken over the lowest <span class="math">\(N\)</span> energies. Some of the <span class="math">\(\psi_i\)</span> can be
degenerated, but it doesn&#8217;t matter - the index <span class="math">\(i\)</span> counts every eigenfunction
including all the degenerated. In plain words, the trick is in realizing, that
the ground state energy can be found by minimizing the energy functional
<a href="#equation-Efunct">(4)</a> and in rewriting this functional into the form <a href="#equation-Efunctxc">(9)</a>,
which shows that the interacting system can be treated as a noninteracting one
with a special potential.</p>
</div>
<div class="section" id="the-xc-term">
<h2>The XC Term<a class="headerlink" href="#the-xc-term" title="Permalink to this headline">¶</a></h2>
<p>The exchange and correlation functional</p>
<div class="math">
\[E_{xc}[n]=(T+U)[n]-E_H[n]-T_S[n]\]</div>
<p>can always be written in the form</p>
<div class="math">
\[E_{xc}[n]=\int n({\bf r}')\epsilon_{xc}({\bf r}';n)\d^3r'\]</div>
<p>where the <span class="math">\(\epsilon_{xc}({\bf r}';n)\)</span> is called the XC energy density.
The XC potential is defined as:</p>
<div class="math">
\[V_{xc}({\bf r};n) = {\delta E_{xc}[n]\over\delta n({\bf r})}
    = \epsilon_{xc}({\bf r};n)+ \int n({\bf r}')
        {\delta \epsilon_{xc}({\bf r}';n)\over\delta n({\bf r})}\d^3r'\]</div>
</div>
<div class="section" id="total-energy">
<h2>Total Energy<a class="headerlink" href="#total-energy" title="Permalink to this headline">¶</a></h2>
<p>We already derived all the necessary things above, so we just summarize it here.
The total energy is given by:</p>
<div class="math">
\[E[n]=(T+U)[n]+V[n]=T_s[n]+E_H[n]+(T-T_s+U-E_H)[n]+V[n]=\]\[=T_s[n]+E_H[n]+E_{xc}[n]+V[n]\]</div>
<p>where</p>
<div class="math">
\[T_s[n] = \sum_i \epsilon_i -\int v_s({\bf r})n({\bf r})\d^3r\]\[E_H[n] = \half\int V_H({\bf r}) n({\bf r}) \d^3r\]\[E_{xc}[n]=\int \epsilon_{xc}({\bf r};n) n({\bf r}) \d^3r\]\[V[n]=\int v({\bf r}) n({\bf r}) \d^3r\]</div>
<p>This is the correct, quadratically convergent expression for the total energy.
We use the whole input potential <span class="math">\(V_{in}\equiv v_s\)</span> and its associated
eigenvalues <span class="math">\(\epsilon_i\)</span> to calculate the kinetic energy <span class="math">\(T_s[n]\)</span>, this follows
from the derivation of the expression for <span class="math">\(T_s[n]\)</span>. Then we use the calculated
charge density to express <span class="math">\(E_H[n]\)</span>, <span class="math">\(E_{xc}[n]\)</span> and <span class="math">\(V[n]\)</span>.</p>
<p>If one is not careful about the potential associated with the eigenvalues,
i.e., confusing <span class="math">\(V_{in}\)</span> with <span class="math">\(V_{out}\)</span>, one gets a slowly converging formula
for the total energy. By expanding <span class="math">\(v_s\)</span> using <a href="#equation-V_in">(12)</a>:</p>
<div class="math">
\[\int v_s n({\bf r})\d^3 r
    = \int (V_H + V_{xc} + v) n({\bf r})\d^3 r
    = 2 \half\int V_H n({\bf r})\d^3 r
    + \int V_{xc} n({\bf r})\d^3 r
    + \int v n({\bf r})\d^3 r =\]\[    = 2 E_H[n] + \int V_{xc} n({\bf r})\d^3 r + V[n]\]</div>
<p>So <span class="math">\(T_s\)</span> is equal to:</p>
<div class="math">
\[T_s[n] = \sum_i \epsilon_i -\int v_s({\bf r})n({\bf r})\d^3r =\]\[    = \sum_i \epsilon_i - 2 E_H[n] - \int V_{xc} n({\bf r})\d^3 r - V[n]\]</div>
<p>And then the slowly converging form of total energy is:</p>
<div class="math">
\[E[n] = T_s[n]+E_H[n]+E_{xc}[n]+V[n]
    = \sum_i \epsilon_i - 2 E_H[n] - \int V_{xc} n({\bf r})\d^3 r - V[n]
        +E_H[n]+E_{xc}[n]+V[n] =\]\[    = \sum_i \epsilon_i - E_H[n] + E_{xc}[n]
        -\int V_{xc}({\bf r};n) n({\bf r}) \d^3r\]</div>
<p>The reason it is slowly converging is because the new formula for kinetic
energy is mixing <span class="math">\(V_{in}\)</span> with <span class="math">\(V_{out}\)</span>, so it is not as precise (see above)
and converges much slower with SCF iterations. Once self-consistency has been
achieved (i.e. <span class="math">\(V_{in}=V_{out}\)</span>), the two expressions for total energy are
equivalent.</p>
</div>
<div class="section" id="xc-approximations">
<h2>XC Approximations<a class="headerlink" href="#xc-approximations" title="Permalink to this headline">¶</a></h2>
<p>All the expressions above are exact (no approximation has been made so far).
Unfortunately, no one knows <span class="math">\(\epsilon_{xc}({\bf r}';n)\)</span> exactly (yet). As such,
various approximations for it exist.</p>
<div class="section" id="lda">
<h3>LDA<a class="headerlink" href="#lda" title="Permalink to this headline">¶</a></h3>
<p>The most
simple approximation is the <em>local density approximation</em> (LDA), for which the
xc energy density <span class="math">\(\epsilon_{xc}\)</span> at <span class="math">\(\bf r\)</span> is taken as that of a homogeneous
electron gas (the nuclei are replaced by a uniform positively charged
background, density <span class="math">\(n=\rm const\)</span>) with the same local density:</p>
<div class="math">
\[\epsilon_{xc}({\bf r};n)\approx\epsilon_{xc}^{LD}(n({\bf r}))\]</div>
<p>The xc potential <span class="math">\(V_{xc}\)</span> defined by <a href="#equation-Vxcpot">(10)</a> is then</p>
<div class="math">
\[V_{xc}({\bf r};n)={\delta E_{xc}[n]\over\delta n({\bf r})}= \epsilon_{xc}({\bf r};n)+ \int n({\bf r}'){\delta \epsilon_{xc}({\bf r}';n)\over\delta n({\bf r})}\d^3r'\]</div>
<p>which in the LDA becomes</p>
<div class="math" id="equation-Vxcld">
<span class="eqno">(15)</span>\[V_{xc}({\bf r};n) =\epsilon_{xc}^{LD}(n)+n{\d \epsilon_{xc}^{LD}(n)\over \d n}= {\d \over \d n}\left(n\epsilon_{xc}^{LD}(n)\right)= V_{xc}^{LD}(n)\]</div>
<p>The xc energy density <span class="math">\(\epsilon_{xc}^{LD}\)</span> of the homogeneous gas can be
computed exactly:</p>
<div class="math">
\[\epsilon_{xc}^{LD}(n)=\epsilon_x^{LD}(n)+\epsilon_c^{LD}(n)\]</div>
<p>where the <span class="math">\(\epsilon_x^{LD}\)</span> is the electron gas exchange term given
by</p>
<div class="math">
\[\epsilon_x^{LD}(n)=-{3\over4\pi}(3\pi^2 n)^{1\over3}\]</div>
<p>the rest of <span class="math">\(\epsilon_{xc}^{LD}\)</span> is hidden in <span class="math">\(\epsilon_c^{LD}(n)\)</span> for which
there doesn&#8217;t exist an analytic formula, but the correlation energies are known
exactly from quantum Monte Carlo (QMC) calculations by Ceperley and
Alder <a class="reference internal" href="#pickett" id="id4">[pickett]</a>. The energies were fitted by Vosko, Wilkes and Nussair
(VWN) with <span class="math">\(\epsilon_c^{LD}(n)\)</span> and they got accurate results with errors less
than <span class="math">\(0.05\rm\,mRy\)</span> in <span class="math">\(\epsilon_c^{LD}\)</span>, which means that <span class="math">\(\epsilon_c^{LD}(n)\)</span>
is virtually known exactly. VWN result:</p>
<div class="math">
\[\epsilon_c^{LD}(n)\approx {A\over2}\left\{ \ln\left(y^2\over Y(y)\right)+{2b\over Q}\arctan\left(Q\over 2y+b\right)+ \right.\]\[\left. -{by_0\over Y(y_0)}\left[\ln\left((y-y_0)^2\over Y(y)\right) +{2(b+2y_0)\over Q}\arctan\left(Q\over 2y+b\right) \right] \right\}\]</div>
<p>where <span class="math">\(y=\sqrt{r_s}\)</span>, <span class="math">\(Y(y)=y^2+by+c\)</span>, <span class="math">\(Q=\sqrt{4c-b^2}\)</span>, <span class="math">\(y_0=-0.10498\)</span>,
<span class="math">\(b=3.72744\)</span>, <span class="math">\(c=12.9352\)</span> (note that the value of <span class="math">\(c\)</span> is wrong in
<a class="reference internal" href="#pickett" id="id5">[pickett]</a>), <span class="math">\(A=0.0621814\)</span> and <span class="math">\(r_s\)</span> is the electron gas
parameter, which gives the mean distance between electrons (in atomic units):</p>
<div class="math">
\[r_s=\left(3\over4\pi n\right)^{1\over3}\]</div>
<p>The xc potential is then computed from <a href="#equation-Vxcld">(15)</a>:</p>
<div class="math">
\[V_{xc}^{LD}=V_x^{LD}+V_c^{LD}\]\[V_x^{LD}=-{1\over\pi}(3\pi^2 n)^{1\over3} = {4\over 3}\epsilon_x^{LD}\]\[V_c^{LD}={A\over2}\left\{ \ln\left(y^2\over Y(y)\right)+{2b\over Q}\arctan\left(Q\over 2y+b\right)+ \right.\]\[\left. -{by_0\over Y(y_0)}\left[\ln\left((y-y_0)^2\over Y(y)\right) +{2(b+2y_0)\over Q}\arctan\left(Q\over 2y+b\right) \right] \right\}+\]\[-{A\over6}{c(y-y_0)-by_0y\over (y-y_0)Y(y)}\]</div>
<p>Some people also use Perdew and Zunger formulas, but they give essentially the
same results. The LDA, although very simple, is surprisingly successful. More
sophisticated approximations exist, for example the generalized gradient
approximation (GGA), which sometimes gives better results than the LDA, but is
not perfect either. Other options include orbital-dependent (implicit) density
functionals or a linear response type functionals, but this topic is still
evolving. The conclusion is, that the LDA is a good approximation to start
with, and only when we are not satisfied, we will have to try some more
accurate and modern approximation.</p>
</div>
<div class="section" id="rlda">
<h3>RLDA<a class="headerlink" href="#rlda" title="Permalink to this headline">¶</a></h3>
<p>Relativistic corrections to the energy-density functional (RLDA) were proposed
by MacDonald and Vosko:</p>
<div class="math">
\[\epsilon_x^{RLD}(n) = \epsilon_x^{LD}(n)R\]\[R = 1-{3\over2}\left(\beta\mu-\ln(\beta+\mu)\over\beta^2\right)^2
= 1-{3\over2} A^2\]</div>
<p>where</p>
<div class="math">
\[\mu=\sqrt{1+\beta^2}\]\[\beta={(3\pi^2n)^{1\over3}\over c} = -{4\pi\over 3c} \epsilon_x^{LD}\]\[A = {\beta\mu-\log(\beta+\mu)\over\beta^2}\]</div>
<p>We now calculate <span class="math">\(V_x^{RLD}\)</span>:</p>
<div class="math" id="equation-RLDA">
<span class="eqno">(16)</span>\[V_x^{RLD}
=\epsilon_x^{LD}R+n{\d \epsilon_x^{LD}R\over\d n}=\]\[=\epsilon_x^{LD}R+n{\d \epsilon_x^{LD}\over\d n}R
    +n\epsilon_x^{LD}{\d R\over\d n}
    =\]\[=\epsilon_x^{LD}R+n{\d \epsilon_x^{LD}\over\d n}R
    +n\epsilon_x^{LD}{\d R\over\d \beta}{\d\beta\over\d n}\]</div>
<p>where the derivative <span class="math">\({\d\beta\over\d n}\)</span> can be evaluated as follows:</p>
<div class="math">
\[{\d \beta\over\d n}
    = {\d \over \d n}{(3\pi^2n)^{1\over3}\over c}
    = {1 \over 3n}{(3\pi^2n)^{1\over3}\over c}
    = {\beta\over 3n}\]</div>
<p>And <span class="math">\({\d \epsilon_x^{LD}\over\d n}\)</span> in exactly the same manner:</p>
<div class="math">
\[{\d \epsilon_x^{LD}\over\d n} = ... = {\epsilon_x^{LD}\over 3n}\]</div>
<p>So we can write</p>
<div class="math">
\[V_x^{RLD}
=\epsilon_x^{LD}R+n{\d \epsilon_x^{LD}\over\d n}R
    +n\epsilon_x^{LD}{\d R\over\d \beta}{\d\beta\over\d n}
=\]\[=\epsilon_x^{LD}R+n{\epsilon_x^{LD}\over 3n}R
    +n\epsilon_x^{LD}{\d R\over\d \beta}{\beta\over 3n}
=\]\[=
{4\over3}\epsilon_x^{LD}R+{1\over3}\epsilon_x^{LD}{\d R\over\d\beta}\beta
=\]\[=
{4\over3}\epsilon_x^{LD}\left(R+{1\over4}\beta{\d R\over\d\beta}\right)
=\]\[=
V_x^{LD}\left(R+{1\over4}\beta{\d R\over\d\beta}\right)\]</div>
<p>where</p>
<div class="math">
\[{\d R\over\d \beta}= -{3\over 2} 2 A A' = -3AA'
=\]\[=-6 A \left({1\over\mu} - {A\over\beta}\right)\]</div>
<p>where we used the derivative of <span class="math">\(A(\beta)\)</span>, which after a tedious, but
straightforward differentiation is:</p>
<div class="math">
\[A'(\beta) = \cdots = 2\left({1\over\mu} - {A\over\beta}\right)\]</div>
<p>Plugging this back in, we get:</p>
<div class="math">
\[V_x^{RLD} = V_x^{LD}\left(R+{1\over4}\beta{\d R\over\d\beta}\right)
=\]\[=
V_x^{LD}\left(1-{3\over 2}A^2 +{1\over4}\beta(-6A)
\left({1\over\mu} - {A\over\beta}\right)
\right)
=\]\[=
V_x^{LD}\left(1-{3\over 2}A^2 + {6\over4} A^2-{6\over4}\beta {A\over\mu}
\right)
=\]\[=
V_x^{LD}\left(1-{3\over2}{\beta\over\mu} A
\right)
=\]\[=
V_x^{LD}\left(1-{3\over2}{\beta\over\mu} \left(
    \beta\mu - \log(\beta+\mu) \over \beta^2\right)
\right)
=\]\[=
V_x^{LD}\left(1-{3\over2} \left(
    \beta\mu - \log(\beta+\mu) \over \beta\mu\right)
\right)
=\]\[= V_x^{LD}\left({3\log(\beta+\mu) \over 2\beta\mu}-\half\right)\]</div>
<p>For <span class="math">\(c\to\infty\)</span> we get <span class="math">\(\beta\to0\)</span>, <span class="math">\(R\to1\)</span> and <span class="math">\(V_x^{RLD}\to
{4\over3}\epsilon_x^{LD}=V_x^{LD}\)</span> as expected, because</p>
<div class="math">
\[\lim_{\beta\to0}{\beta\sqrt{1+\beta^2}-\ln(\beta+\sqrt{1+\beta^2})\over \beta^2} = 0\]</div>
<p>Code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">limit</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">log</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">)</span>
<span class="go">beta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">limit</span><span class="p">((</span><span class="n">beta</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">beta</span><span class="o">+</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span><span class="o">/</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="radial-dft-problem">
<h2>Radial DFT Problem<a class="headerlink" href="#radial-dft-problem" title="Permalink to this headline">¶</a></h2>
<div class="section" id="kohn-sham-equations">
<h3>Kohn-Sham Equations<a class="headerlink" href="#kohn-sham-equations" title="Permalink to this headline">¶</a></h3>
<p>For spherically symmetric potentials, we write all eigenfunctions as:</p>
<div class="math">
\[\psi_{nlm} = R_{nl} Y_{lm}\]</div>
<p>and we need to solve the following Kohn-Sham equations:</p>
<div class="math">
\[-{1\over2}R_{nl}'' - {1\over r}R_{nl}' +
    \left(V + {l(l+1)R\over2 r^2}\right)R_{nl} = \epsilon_{nl} R_{nl}\]</div>
<p>With normalization:</p>
<div class="math">
\[\int R_{nl}^2 \,r^2 \,\d r = 1\]</div>
<p>For Schroedinger equation, the charge density is calculated by adding all &#8220;(n,
l, m)&#8221; states together, counting each one twice (for spin up and spin
down):</p>
<div class="math">
\[n({\bf r}) = \sum_{nlm}2|\psi_{nlm}|^2
    = \sum_{nlm}R_{nl}^2 2|Y_{lm}|^2
    = \sum_{nl}R_{nl}^2 2\sum_m|Y_{lm}|^2
    = {1\over 4\pi}\sum_{nl}f_{nl} R_{nl}^2\]</div>
<p>where we have introduced the occupation numbers <span class="math">\(f_{nl}\)</span> by</p>
<div class="math">
\[f_{nl} = 4\pi\,2\sum_m |Y_{lm}|^2\]</div>
<p>Normalization of the charge density is:</p>
<div class="math">
\[Z = \int n({\bf r}) \d^3 x
    = \int n(r) \, r^2\d\Omega \d r
    = 4\pi\int n(r) \, r^2 \d r
    =\]\[    = 4\pi\int {1\over 4\pi} \sum_{nl} f_{nl} R_{nl}^2\, r^2\d\Omega \d r
    =\]\[    = \sum_{nl} f_{nl}\int R_{nl}^2\, r^2 \d r
    =\]\[    = \sum_{nl} f_{nl}\]</div>
<p>So we can see, that it must hold:</p>
<div class="math">
\[\sum_{nl} f_{nl} = Z\]</div>
<p>where <span class="math">\(Z\)</span> is the atomic number (number of electrons), and as such, <span class="math">\(f_{nl}\)</span> are
indeed the occupation numbers (integers). The factor <span class="math">\(4\pi\)</span> is
explicitly factored out, as it cancels with the spherical harmonics:
assuming all <span class="math">\(m\)</span> states are occupied, this can be simplified to:</p>
<div class="math">
\[f_{nl} = 4\pi\,2\sum_m |Y_{lm}|^2
    = 4\pi\,2{2l+1\over 4\pi}
    = 2(2l+1)\]</div>
<p>We can also use this machinery to prescribe &#8220;chemical occupation numbers&#8221;, that
don&#8217;t necessarily correspond to the DFT ground state. For example for <span class="math">\(U\)</span> atom
we get:</p>
<div class="math">
\[f_{1l} = 2 (2l+1)\]\[f_{2l} = 2 (2l+1)\]\[f_{3l} = 2 (2l+1)\]\[f_{4l} = 2 (2l+1)\]\[f_{5l} = 2 (2l+1)\quad\quad l\le2\]\[f_{53} = 3\]\[f_{60} = 2\]\[f_{61} = 6\]\[f_{62} = 1\]\[f_{70} = 2\]</div>
<p>By summing all these <span class="math">\(f_{nl}\)</span>, we get 92 as expected:</p>
<div class="math">
\[\sum_{nl} f_{nl} = 2 + (2+6) + (2+6+10) + (2+6+10+14) + (2+6+10) +\]\[    + 3 + 2 + 6 + 1 + 2 = 92\]</div>
<p>But this isn&#8217;t the DFT ground state, because some KS energies are skipped, for
example there is only one state for <span class="math">\(n=6\)</span>, <span class="math">\(l=2\)</span>, but there are nine more
states with the same energy &#8212; instead two more states are occupied in <span class="math">\(n=7\)</span>,
<span class="math">\(l=0\)</span>, but those have higher energy. So this corresponds to excited DFT state,
strictly speaking not physically valid in the DFT formalism, but in practice
this approach is often used. One can also prescribe fractional occupation
numbers (in the Dirac case).</p>
</div>
<div class="section" id="poisson-equation">
<h3>Poisson Equation<a class="headerlink" href="#poisson-equation" title="Permalink to this headline">¶</a></h3>
<p>Poisson equation becomes:</p>
<div class="math">
\[V_H''(r) + {2\over r} V_H'(r) = -4\pi n(r)\]</div>
</div>
<div class="section" id="id6">
<h3>Total Energy<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The total energy is given by:</p>
<div class="math">
\[E[n]= T_s[n]+E_H[n]+E_{xc}[n]+V[n]\]</div>
<p>where</p>
<div class="math">
\[T_s[n] = \sum_{nl} f_{nl}\epsilon_{nl}
    -\int (V_H(r) + V_{xc}(r) + v(r))_{in} n(r) \d^3 r
    =\]\[    = \sum_{nl} f_{nl}\epsilon_{nl}
        -\int \left(V_H(r) + V_{xc}(r) -{Z\over r}\right)_{in} n(r) \d^3 r\]\[E_H[n] = \half\int V_H(r) n(r) \d^3r\]\[E_{xc}[n]=\int \epsilon_{xc}(r;n) n(r) \d^3r\]\[V[n]=\int v(r) n(r) \d^3r = -\int {Z\over r} n(r) \d^3r\]</div>
<p>doing the integrals a bit we get:</p>
<div class="math">
\[T_s[n] = \sum_{nl} f_{nl}\epsilon_{nl}
        -4\pi\int \left(V_H(r) + V_{xc}(r) -{Z\over r}\right)_{in} n(r)
            r^2\,\d r\]\[E_H[n] = 2\pi\int V_H(r) n(r)r^2\, \d r\]\[E_{xc}[n]=4\pi\int \epsilon_{xc}(r;n) n(r)r^2\, \d r\]\[V[n]=-4\pi \int {Z\over r} n(r)r^2\, \d r
    =-4\pi Z \int n(r)r\, \d r\]</div>
<p>We can also express everything using the charge density <span class="math">\(\rho(r) = -n(r)\)</span>:</p>
<div class="math">
\[T_s[n] = \sum_{nl} f_{nl}\epsilon_{nl}
        +4\pi\int \left(V_H(r) + V_{xc}(r) -{Z\over r}\right)_{in} \rho(r)
            r^2\,\d r\]\[E_H[n] = -2\pi\int V_H(r) \rho(r)r^2\, \d r\]\[E_{xc}[n]=-4\pi\int \epsilon_{xc}(r;n) \rho(r)r^2\, \d r\]\[V[n]=4\pi \int {Z\over r} \rho(r)r^2\, \d r
    =4\pi Z \int \rho(r)r\, \d r\]</div>
</div>
</div>
<div class="section" id="dft-as-a-nonlinear-problem">
<h2>DFT As a Nonlinear Problem<a class="headerlink" href="#dft-as-a-nonlinear-problem" title="Permalink to this headline">¶</a></h2>
<p>The task is to find such a charge density <span class="math">\(n\)</span>, so that all the equations below
hold (e.g. are self-consistent):</p>
<div class="math">
\[V = -{Z\over r} + V_H + V_{xc}\]\[\left(-\nabla^2+V\right)\phi_m = \epsilon_m\phi_m,\quad\quad m = 1, 2, \dots, 4\]\[n = \sum_{m=1}^4 \phi_m^2\]\[V_{xc} = f(n)\]\[\nabla^2 V_H = -4\pi n\]</div>
<p>This is a standard nonlinear problem, except that the Jacobian is dense, as
shown below.</p>
<div class="section" id="reformulation">
<h3>Reformulation<a class="headerlink" href="#reformulation" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s write everything in terms of <span class="math">\(\phi_m(x)\)</span> explicitly:</p>
<div class="math">
\[n(x) = \sum_{m=1}^4 \phi_m^2(x)\]\[V_{xc}(x) = f(n(x)) = f\left( \sum_{m=1}^4\phi_m^2(x) \right)\]\[V_H(x) = \int_\Omega {n(x')\over|x' - x|}\d x'=
\int_\Omega {
\sum_{m=1}^4 \phi_m^2(x')
\over|x' - x|}\d x'\]\[V(x) = -{Z\over r} + V_H(x) + V_{xc}(x)=\]\[=-{Z\over r}+
\int_\Omega {
\sum_{m=1}^4 \phi_m^2(x')
\over|x' - x|}\d x'
+f\left( \sum_{m=1}^4\phi_m^2(x) \right)\]</div>
<p>Now we can write everything as just one (nonlinear)
equation:</p>
<div class="math">
\[\left(-\nabla^2
-{Z\over r}+
\int_\Omega {
\sum_{m=1}^4 \phi_m^2(x')
\over|x' - x|}\d x'
+f\left( \sum_{m=1}^4\phi_m^2(x) \right)
\right)\phi_n = \epsilon_n\phi_n,\quad\quad n = 1, 2, \dots, 4\]</div>
</div>
<div class="section" id="fe-discretization">
<h3>FE Discretization<a class="headerlink" href="#fe-discretization" title="Permalink to this headline">¶</a></h3>
<p>The correspondig discrete problem has the form</p>
<div class="math">
\[\int_\Omega \nabla\phi_n(x)\cdot\nabla v_i(x)+\left[
-{Z\over r}+
\int_\Omega {
\sum_{m=1}^4 \phi_m^2(x')
\over|x' - x|}\d x'
+f\left( \sum_{m=1}^4\phi_m^2(x) \right)
\right]
\phi_n(x) v_i(x)  \d x=\]\[=\int_\Omega
\epsilon_n\phi_n(x) v_i(x) \d x,\quad\quad n = 1, 2, \dots, 4;\quad
i = 1, 2, \dots, N\]</div>
<p>where</p>
<div class="math">
\[\phi_n = \phi_n({\bf Y}^{(n)}) = \sum_{j=1}^N y_j^{(n)} v_j(x)\]</div>
<p>Here <span class="math">\({\bf Y}^{(n)} = (y_1^{(n)}, y_2^{(n)}, \dots, y_N^{(n)})^T\)</span> is the vector
of unknown coefficients for the <span class="math">\(n\)</span>-th wavefunction <span class="math">\(\phi_n(x)\)</span>. Our equation
can then be written in the compact form</p>
<div class="math">
\[{\bf F}({\bf Y}^{(n)}) = {\bf 0},\quad\quad n = 1, 2, \dots, 4\]</div>
<p>where <span class="math">\({\bf F} = (F_1, F_2, \dots, F_N)^T\)</span> with</p>
<div class="math">
\[F_i({\bf Y}^{(n)}) =
\int_\Omega \nabla\phi_n(x)\cdot\nabla v_i(x)+\left[
-{Z\over r}+
\int_\Omega {
\sum_{m=1}^4 \phi_m^2(x')
\over|x' - x|}\d x'
+f\left( \sum_{m=1}^4\phi_m^2(x) \right)
\right]
\phi_n(x) v_i(x)  \d x-\]\[-\int_\Omega
\epsilon_n\phi_n(x) v_i(x) \d x\]</div>
</div>
<div class="section" id="jacobian">
<h3>Jacobian<a class="headerlink" href="#jacobian" title="Permalink to this headline">¶</a></h3>
<p>The Jacobi matrix has the elements:</p>
<div class="math">
\[J_{ik} = {\partial F_i\over\partial y_k^{(s)}}\]</div>
<p>The only possible dense term is:</p>
<div class="math">
\[{\partial\over\partial y_k^{(s)}}\int_\Omega \int_\Omega {
\sum_{m=1}^4 \phi_m^2(x')
\over|x' - x|}\d x'\,\phi_n(x) v_i(x) \d x =\]\[=
{\partial\over\partial y_k^{(s)}}\int_\Omega \int_\Omega {
\sum_{m=1}^4 \left(\sum_{j=1}^N y_j^{(m)} v_j(x')\right)^2
\over|x' - x|}\d x'\, \left(\sum_{j=1}^N y_j^{(n)} v_j(x)\right)  v_i(x) \d x =\]\[=
\int_\Omega \int_\Omega {
2 \left(\sum_{j=1}^N y_j^{(s)} v_j(x')\right)v_k(x')
\over|x' - x|}\d x'\, \left(\sum_{j=1}^N y_j^{(n)} v_j(x)\right)  v_i(x) \d x +\]\[+
\int_\Omega \int_\Omega {
\sum_{m=1}^4 \left(\sum_{j=1}^N y_j^{(m)} v_j(x')\right)^2
\over|x' - x|}\d x'\, \delta_{ns}v_k(x)  v_i(x) \d x\]</div>
<p>Now we can see that we have in there the following term:</p>
<div class="math">
\[\int_\Omega \int_\Omega {v_k(x') v_i(x)\over |x'-x|}\d x'\d x\]</div>
<p>which is dense in <span class="math">\((ki)\)</span>, as can be easily seen be fixing <span class="math">\(i\)</span> and writing</p>
<div class="math">
\[\int_\Omega \int_\Omega {v_k(x')\over |x'-x|}\d x' v_i(x)\d x\]</div>
<p>so for each <span class="math">\(k\)</span> there is some contribution from the integral <span class="math">\(\int_\Omega
{v_k(x')\over |x'-x|}\d x'\)</span> for such <span class="math">\(x\)</span> where <span class="math">\(v_i(x)\)</span> is nonzero, thus
making the Jacobian <span class="math">\(J_{ik}\)</span> dense.</p>
</div>
</div>
<div class="section" id="thomas-fermi-dirac-theory">
<h2>Thomas-Fermi-Dirac Theory<a class="headerlink" href="#thomas-fermi-dirac-theory" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to derive equations for Thomas-Fermi-Dirac theory. One way
is to start from grand potential and derive all equations from it. The other
way is to start with low level equations and build our way up. Will start with
the former.</p>
<div class="section" id="top-down-approach">
<h3>Top Down Approach<a class="headerlink" href="#top-down-approach" title="Permalink to this headline">¶</a></h3>
<p>We start with a grand potential for fermions:</p>
<div class="math">
\[\Omega[\beta, \mu]
= -\sum_i {1\over\beta}
    \log\left(\sum_{N=0}^1 e^{-\beta\left(N\epsilon_i - N\mu\right)}\right)
        =\]\[= -\sum_i {1\over\beta}
    \log\left(1 + e^{-\beta\left(\epsilon_i - \mu\right)}\right)
        =\]\[= -{1\over\beta}
    \int \int {2\d^3 x \d^3 p \over (2\pi)^3} \log\left(1 +
        e^{-\beta\left({p^2\over 2} + V({\bf x}) - \mu\right)}\right)
        -E_{ee} =\]\[= -{2\over\beta}
    \int \d^3 x \int_0^\infty{ 4\pi p^2 \d p \over (2\pi)^3} \log\left(1 +
        e^{-\beta\left({p^2\over 2} + V({\bf x}) - \mu\right)}\right)
        -E_{ee} =\]\[= -{1\over \pi^2 \beta}
    \int \d^3 x \int_0^\infty p^2 \log\left(1 +
        e^{-\beta\left({p^2\over 2} + V({\bf x}) - \mu\right)}\right) \d p
        -E_{ee} =\]\[= -{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
    \int \d^3 x \int_0^\infty {u^{3\over2} \over
        1 + e^{u-\beta\left(\mu-V({\bf x})\right)}} \d u -E_{ee} =\]\[= -{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
    \int I_{3\over2}\left(\beta\left(\mu-V({\bf x})\right)\right) \,\d^3 x
    -E_{ee} =\]\[= -{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
    \int I_{3\over2}\left(\beta\left(\mu-V({\bf x})\right)\right) \,\d^3 x
    -\half \int n_e(\mathbf{x}) V_{ee}(\mathbf{x}) \d^3 x\,.\]</div>
<p>The potential
<span class="math">\(V({\bf x}) = V_{en}({\bf x}) + V_{ee}({\bf x}) + V_{xc}({\bf x})\)</span>
is the total potential that the electrons experience (it contains nuclear,
Hartree, and XC terms) and <span class="math">\(E_{ee}\)</span> is the Hartree energy:</p>
<div class="math">
\[E_{ee}
    = \half \int {n_e(\mathbf{x}) n_e(\mathbf{x}')\over
        |\mathbf{x} - \mathbf{x}'|}\d^3 x\d^3 x'
    = \half \int n_e(\mathbf{x}) V_{ee}(\mathbf{x}) \d^3 x\,.\]</div>
<p>The density is a functional derivative with respect to
<span class="math">\(\mu\)</span>:</p>
<div class="math">
\[n_e({\bf x}) = - {\delta \Omega[\beta, \mu] \over \delta \mu}
    = {2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
        {\partial \over \partial \mu}
            I_{3\over2}\left(\beta\left(\mu-V({\bf x})\right)\right)
    = {2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
        \beta {3\over 2} I_{1\over2}
            \left(\beta\left(\mu-V({\bf x})\right)\right) =\]\[    = {\sqrt2 \over \pi^2 \beta^{3\over2}} I_{1\over2}
            \left(\beta\left(\mu-V({\bf x})\right)\right)\]</div>
<p>By defining the function <span class="math">\(\Phi(n_e({\bf x}))\)</span>:</p>
<div class="math">
\[\Phi(n_e({\bf x})) = \beta\left(\mu-V({\bf x})\right)
    = I_{1\over2}^{-1}\left(
            {\pi^2 \beta^{3\over2} \over \sqrt 2} n_e({\bf x})
        \right)\]</div>
<p>we can express the grand potential using <span class="math">\(n_e\)</span> as follows:</p>
<div class="math">
\[\Omega[\beta, n_e]
    = -{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
        \int I_{3\over2}(\Phi(n_e({\bf x}))) \, \d^3 x
      - \half \int n_e(\mathbf{x}) V_{ee}(\mathbf{x}) \d^3 x\,.\]</div>
<p>Now we can calculate the free energy:</p>
<div class="math">
\[F_e[\beta, n_e] = \Omega[\beta, n_e] + \mu N
    = \Omega[\beta, n_e] + \mu \int n_e({\bf x}) \,\d^3 x =\]\[    = \int \left(-{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
          I_{3\over2}(\Phi(n_e({\bf x})))
        + \mu n_e({\bf x})
        - \half n_e(\mathbf{x}) V_{ee}(\mathbf{x}) \right)\d^3 x =\]\[    = \int \left(-{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
          I_{3\over2}(\Phi(n_e({\bf x})))
        + {1\over \beta} n_e({\bf x}) \Phi(n_e({\bf x}))
            + n_e({\bf x}) V({\bf x})
            - \half n_e(\mathbf{x}) V_{ee}(\mathbf{x})
            \right)\d^3 x =\]\[    = \int \left(-{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
          I_{3\over2}(\Phi(n_e({\bf x})))
        + {1\over \beta} n_e({\bf x}) \Phi(n_e({\bf x}))
            + n_e({\bf x})\left( V_{en}({\bf x})
              +\half V_{ee}(\mathbf{x})
              + V_{xc}(\mathbf{x}) \right)
            \right)\d^3 x\,,\]</div>
<p>where we used the fact that <span class="math">\(\mu = {1\over \beta} \Phi(n_e({\bf x})) + V({\bf
x})\)</span>, i.e. the left hand side <span class="math">\(\mu\)</span> is a constant, thus the sum of the terms on
the right hand side is also constant (even though the individual terms are
not).</p>
<p>To determine the kinetic part of the free energy, we set all potentials equal
to zero (<span class="math">\(V({\bf x}) = V_{en}({\bf x}) = V_{ee}({\bf x}) = V_{xc}({\bf x}) =
0\)</span>) and obtain:</p>
<div class="math">
\[F_{kin}[\beta, n_e]
    = \int \left(-{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
          I_{3\over2}(\Phi(n_e({\bf x})))
        + {1\over \beta} n_e({\bf x}) \Phi(n_e({\bf x}))
            \right)\d^3 x\,.\]</div>
<p>If the potentials are zero, then the pressure can be calculated
from:</p>
<div class="math">
\[P = -{1\over V}\Omega[\beta, n_e]
    = {2\sqrt2 \over 3 \pi^2 \beta^{5\over2}V}
        \int I_{3\over2}(\Phi(n_e({\bf x}))) \,\d^3 x =\]\[= {2\sqrt2 \over 3 \pi^2 \beta^{5\over2}V}
        \int I_{3\over2}(\beta\mu) \,\d^3 x
= {2\sqrt2 \over 3 \pi^2 \beta^{5\over2}} I_{3\over2}(\beta\mu) \,.\]</div>
</div>
<div class="section" id="bottom-up-approach">
<h3>Bottom Up Approach<a class="headerlink" href="#bottom-up-approach" title="Permalink to this headline">¶</a></h3>
<p>The other way to derive these equations is to use the following considerations.
The number of states in a box of side <span class="math">\(L\)</span> is given by:</p>
<div class="math">
\[N = \int {\d^3 p \over h^3} 2 L^3
  = \int {\d^3 p \over (2\pi\hbar)^3} 2 L^3
  = \int {\d^3 p \over (2\pi)^3} 2 L^3
  = \int_0^{p_f} {4\pi p^2 \d p\over (2\pi)^3} 2 L^3
  = {L^3\over\pi^2} \int_0^{p_f} p^2 \d p\]</div>
<p>We use atomic units, so <span class="math">\(\hbar=1\)</span>.
The electronic particle density is:</p>
<div class="math" id="equation-tf_low">
<span class="eqno">(17)</span>\[n_e({\bf x}) = {N \over L^3}
  = {1\over\pi^2} \int_0^{p_f} p^2 \d p
  = {p_f^3 \over 3\pi^2}
  = {\left[2(E_f - V({\bf x}))\right]^{3\over2} \over 3\pi^2}\]</div>
<p>where we used the relation for Fermi energy <span class="math">\(E_f = {p_f^2\over 2} + V({\bf
x})\)</span>. The potential <span class="math">\(V({\bf x})\)</span> is the total potential that the electrons
experience (it contains Hartree, nuclear and XC terms).
At finite temperature <span class="math">\(T\)</span> we need to use the Fermi distribution and this
generalizes to:</p>
<div class="math">
\[n_e({\bf x})
  = {1\over\pi^2} \int_0^{\infty} {p^2 \d p \over
        e^{\beta(E-\mu)} + 1}\]</div>
<p>Now we use the relation <span class="math">\(E = {p^2\over 2} + V({\bf x})\)</span> and substitutions
<span class="math">\(\epsilon={p^2\over 2}\)</span>, <span class="math">\(y = \beta \epsilon\)</span> to rewrite this using the
<a class="reference internal" href="../math/other.html#fermi-integral"><em>Fermi-Dirac Integral</em></a>:</p>
<div class="math">
\[n_e({\bf x})
  = {1\over\pi^2} \int_0^{\infty} {p^2 \d p \over
        e^{\beta(E-\mu)} + 1}
  = {1\over\pi^2} \int_0^{\infty} {p^2 \d p \over
        e^{\beta({p^2\over 2} + V({\bf x})-\mu)} + 1}
  = {\sqrt 2\over\pi^2} \int_0^{\infty} {\sqrt\epsilon \d \epsilon \over
        e^{\beta(\epsilon + V({\bf x})-\mu)} + 1}
  =\]\[  = {\sqrt 2\over\pi^2 \beta^{3\over2}} \int_0^{\infty} {\sqrt y \d y \over
        e^{y - \beta(\mu - V({\bf x}))} + 1}
  = {\sqrt 2\over\pi^2 \beta^{3\over2}}
        I_{1\over2}\left(\beta(\mu - V({\bf x}))\right)\]</div>
<p>At low temperature (<span class="math">\(T\to0\)</span>) we have
<span class="math">\(\beta \to \infty\)</span>, <span class="math">\(I_{1\over2}(x) \to {2\over3} x^{3\over 2}\)</span> and we obtain:</p>
<div class="math">
\[n_e({\bf x}) \to
  {2\sqrt 2\over 3\pi^2 \beta^{3\over2}}
        \left(\beta(\mu - V({\bf x}))\right)^{3\over2}
  ={\left[2(\mu - V({\bf x}))\right]^{3\over2} \over 3\pi^2}\]</div>
<p>Identical with <a href="#equation-tf_low">(17)</a>. We can see that the chemical potential <span class="math">\(\mu\)</span>
becomes the Fermi energy <span class="math">\(E_f\)</span> in the limit <span class="math">\(T\to0\)</span>. In the finite-temperature
case, <span class="math">\(\mu\)</span> is determined from the normalization condition for the number of
electrons <span class="math">\(N\)</span>:</p>
<div class="math">
\[N = \int n_e({\bf x})\, d^3 x\]</div>
<p>The kinetic energy is</p>
<div class="math">
\[E_{kin} = \int \d^3 x \int 2 {\d^3p\over (2\pi)^3} {p^2\over 2}
    {1\over e^{\beta(E-\mu)}+1}
=\]\[= \int \d^3 x \int_0^\infty 2 {4\pi p^2 \d p\over (2\pi)^3} {p^2\over 2}
    {1\over e^{\beta(E-\mu)}+1} =\]\[= \int \d^3 x \int_0^\infty 2 {4\pi \sqrt 2\sqrt \epsilon \d \epsilon \over
    (2\pi)^3} \epsilon {1\over e^{\beta(\epsilon + V({\bf x})-\mu)}+1} =\]\[= {\sqrt 2 \over \pi^2} \int \d^3 x \int_0^\infty
    {\epsilon^{3\over2} \d \epsilon \over
    e^{\beta(\epsilon + V({\bf x})-\mu)}+1} =\]\[= {\sqrt 2 \over \pi^2 \beta^{5\over2}} \int \d^3 x \int_0^\infty
    {y^{3\over2} \d y \over e^{y - \beta(\mu -V({\bf x}))}+1} =\]\[= {\sqrt 2 \over \pi^2 \beta^{5\over2}}
    \int I_{3\over2}\left(\beta(\mu - V({\bf x}))\right) \d^3 x\]</div>
<p>From the last formula it can be shown that the kinetic energy is equal to</p>
<div class="math">
\[E_{kin} = {3\over 2} P V - {1\over 2} E_{en} - {1\over 2} E_{ee}\]</div>
<p>The potential energy is equal to:</p>
<div class="math">
\[E_{pot} = E_{en} + E_{ee}\]</div>
<p>The internal energy <span class="math">\(E\)</span> is equal to:</p>
<div class="math">
\[E = E_{kin} + E_{pot}
    = E_{kin} + E_{en} + E_{ee} =\]\[    = {3\over 2} P V + {1\over 2} E_{en} + {1\over 2} E_{ee}\]</div>
<p>The entropy <span class="math">\(S\)</span> is equal to:</p>
<div class="math">
\[TS
   = -{1\over\beta}
     \sum_i [n_i\log n_i + (1-n_i)\log(1-n_i)] =\]\[   = -{1\over\beta}
     \sum_i \left[n_i\log\left(n_i\over 1-n_i\right)
        + \log(1-n_i)\right] =\]\[   =  \left[\sum_i n_i\epsilon_i\right]
   +
    \left[-\sum_i n_i \mu\right]
   +
        \left[-{1\over\beta} \sum_i\log(1-n_i)\right] =\]\[   = \left[E_{kin} + E_{en} + 2 E_{ee}\right]
    +
    \left[-\mu N\right]
    +
    \left[{2\over3}E_{kin}\right]
    =\]\[   = {5\over3}E_{kin} + E_{en} + 2 E_{ee} -\mu N =\]\[   = {5\over2}P V + {1\over6}E_{en} + {7\over6}E_{ee} -\mu N\]</div>
<p>where <span class="math">\(n_i={1\over1+e^{\beta(\epsilon_i-\mu)}}\)</span> is the number of states at
energy <span class="math">\(\epsilon_i\)</span>. We used the following calculation expressing one of the
sums in terms of the kinetic energy:</p>
<div class="math">
\[-{1\over\beta} \sum_i\log(1-n_i) =\]\[    = -{1\over\beta}\int {2\d^3 x \d^3 p\over (2\pi)^3}
        \log {e^{\beta(E-\mu)}\over 1+e^{\beta(E-\mu)}} =\]\[    = -{\sqrt 2\over \pi^2 \beta^{5\over2}}\int \d^3 x \int_0^\infty
        \sqrt{y}\, \d y
        \log {e^{y-\beta(\mu-V({\bf x}))}\over
            1+e^{y-\beta(\mu-V({\bf x}))}} =\]\[    = -{\sqrt 2\over \pi^2 \beta^{5\over2}}\int \d^3 x \left[
        -{2\over3}\int_0^\infty {y^{3\over2} \d y \over
            1+e^{y-\beta(\mu-V({\bf x}))}} \right] =\]\[    = {2\over 3}{\sqrt 2\over \pi^2 \beta^{5\over2}}\int
        I_{3\over2}\left(\beta(\mu-V({\bf x}))\right) \d^3 x =\]\[    = {2\over 3} E_{kin} \,,\]</div>
<p>where we used <span class="math">\(E={p^2\over2}+V({\bf x})\)</span>.</p>
<p>The free energy is equal to:</p>
<div class="math">
\[F = E - TS = -{2\over3}E_{kin} - E_{ee} + \mu N =\]\[    = -PV + {1\over3}E_{en} - {2\over3}E_{ee} +\mu N\]</div>
<p>The grand potential is equal to:</p>
<div class="math">
\[\Omega = F - \mu N = -{2\over3}E_{kin} - E_{ee} =\]\[    = -PV + {1\over3}E_{en} - {2\over3}E_{ee}\]</div>
<p>We can now express the free energy functional <span class="math">\(F_e[\beta, n_e]\)</span> as a function
of the density:</p>
<div class="math">
\[F_e[\beta, n_e] = -{2\over3}E_{kin} - E_{ee} + \mu N =\]\[    = \int \left(-{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
          I_{3\over2}(\Phi(n_e({\bf x})))
          -\half n_e({\bf x}) V_{ee}({\bf x})
        + \mu n_e({\bf x}) \right)\d^3 x =\]\[    = \int \left(-{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
          I_{3\over2}(\Phi(n_e({\bf x})))
          -\half n_e({\bf x}) V_{ee}({\bf x})
        + {1\over \beta} n_e({\bf x}) \Phi(n_e({\bf x}))
            + n_e({\bf x}) V({\bf x}) \right)\d^3 x =\]\[    = \int \left(-{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
          I_{3\over2}(\Phi(n_e({\bf x})))
          -\half n_e({\bf x}) V_{ee}({\bf x})
        + {1\over \beta} n_e({\bf x}) \Phi(n_e({\bf x}))
            + n_e({\bf x}) (V_{en}({\bf x}) + V_{ee}({\bf x})
                + V_{xc}({\bf x}))
              \right)\d^3 x =\]\[    = \int \left(-{2\sqrt2 \over 3 \pi^2 \beta^{5\over2}}
          I_{3\over2}(\Phi(n_e({\bf x})))
        + {1\over \beta} n_e({\bf x}) \Phi(n_e({\bf x}))
            + n_e({\bf x}) (V_{en}({\bf x}) +\half V_{ee}({\bf x})
                + V_{xc}({\bf x}))
              \right)\d^3 x =\]\[    = \left( -{2\over3}E_{kin}
        + \int {1\over \beta} n_e({\bf x}) \Phi(n_e({\bf x}))\, \d^3 x
          \right)
        + E_{en} + E_{ee} + E_{xc}\]</div>
</div>
</div>
<div class="section" id="orbital-free-density-functional-theory">
<h2>Orbital Free Density Functional Theory<a class="headerlink" href="#orbital-free-density-functional-theory" title="Permalink to this headline">¶</a></h2>
<p>The orbital-free electronic free energy is given by:</p>
<div class="math">
\[F_e[n_e] = T_0[n_e] + U_{en}[n_e] + U_{ee}[n_e] + F_{xc}[n_e]\,,\]</div>
<p>where the kinetic energy can be written in a few different equivalent ways as</p>
<div class="math">
\[T_0[n_e] =\]\[= {\sqrt 2\over\pi^2 \beta^{5\over2}}
  \int \left(
            I_{1\over2}\left(\beta(\mu - V({\bf x}))\right)
\beta(\mu-V({\bf x})) -
{2\over 3} I_{3\over2}(\beta(\mu-V({\bf x})))
\right) \d^3 x =\]\[= {1\over\beta} \int \left(
n_e(\mathbf{x}) \beta(\mu-V({\bf x})) -
{2\sqrt2\over 3\pi^2 \beta^{3\over2}} I_{3\over2}(\beta(\mu-V({\bf x})))
\right) \d^3 x =\]\[= {1\over\beta} \int \left(
n_e(\mathbf{x}) \Phi(n_e(\mathbf{x})) -
{2\sqrt2\over 3\pi^2 \beta^{3\over2}} I_{3\over2}(\Phi(n_e(\mathbf{x})))
\right) \d^3 x =\]\[= {1\over\beta} \int \left(
n_e(\mathbf{x}) I_{1\over2}^{-1}(y) -
{2n_e(\mathbf{x})\over 3 y} I_{3\over2}(I_{1\over2}^{-1}(y))
\right) \d^3 x =\]\[= {1\over\beta} \int
n_e(\mathbf{x}) \left( I_{1\over2}^{-1}(y) -
{2\over 3 y} I_{3\over2}(I_{1\over2}^{-1}(y))\right)
\d^3 x =\]\[={1\over\beta} \int n_e(\mathbf{x}) f(y) \d^3 x\,;\quad\quad
y={\pi^2\over\sqrt2}\beta^{3\over2} n_e\,,\]</div>
<p>where <span class="math">\(f(y)\)</span> is a special function of one variable, composed of a
<a class="reference internal" href="../math/other.html#fermi-integral"><em>Fermi-Dirac Integral</em></a> of order <span class="math">\(3\over2\)</span> and its inverse of order <span class="math">\(1\over2\)</span>:</p>
<div class="math">
\[f(y) = I_{1\over2}^{-1}(y) - {2\over 3 y} I_{3\over2}(I_{1\over2}^{-1}(y))\]</div>
<p>the electron-nuclei term has the form</p>
<div class="math">
\[U_{en}[n_e]
    = \int {n_e(\mathbf{x}) n_n(\mathbf{x}')\over
        |\mathbf{x} - \mathbf{x}'|}\d^3 x\d^3 x'
    = \int n_e(\mathbf{x}) V_{en}(\mathbf{x}) \d^3 x\,,\]</div>
<p>The electron-electron (Hartree) term takes the form:</p>
<div class="math">
\[U_{ee}[n_e]
    = \half \int {n_e(\mathbf{x}) n_e(\mathbf{x}')\over
        |\mathbf{x} - \mathbf{x}'|}\d^3 x\d^3 x'
    = \half \int n_e(\mathbf{x}) V_{ee}(\mathbf{x}) \d^3 x\,,\]</div>
<p>and the exchange and correlation functional <span class="math">\(F_{xc}[n_e]\)</span> is given by
the Perdew-Zunger LDA:</p>
<div class="math">
\[F_{xc}[n_e]
    = \int n_e(\mathbf{x}) \epsilon_{xc}^{LD}(n_e) \d^3 x\,,\]</div>
<p><span class="math">\(n_e(\mathbf{x})\)</span> is the (positive) electron density,
<span class="math">\(n_n(\mathbf{x})\)</span> is the (positive) nuclei density.</p>
<p>We minimize this free energy under the condition of particle conservation. The
constrained functional is (we use <span class="math">\(n\equiv n_e\)</span> from now on):</p>
<div class="math">
\[\Omega[n] = F_e[n] - \epsilon \left(\int n(\mathbf{x}) \d^3 x - N\right)\]</div>
<p>The variational solution is:</p>
<div class="math">
\[{\delta \Omega[n] \over \delta n} = 0\]</div>
<p>Or:</p>
<div class="math" id="equation-of-dft0">
<span class="eqno">(18)</span>\[{\delta F_e[n] \over \delta n} = \epsilon\]</div>
<p>Finally we get:</p>
<div class="math" id="equation-of-dft">
<span class="eqno">(19)</span>\[H[n] \equiv {\delta F_e[n] \over \delta n} =
{\delta T_0[n] \over \delta n}
+ {\delta U_{en}[n] \over \delta n}
+ {\delta U_{ee}[n] \over \delta n}
+ {\delta F_{xc}[n] \over \delta n}
= \epsilon\]</div>
<p>The individual terms are:</p>
<div class="math">
\[{\delta T_0[n] \over \delta n} =
    {1\over\beta} \left( f(y) + n(\mathbf{x}) {\d f(y) \over \d y}
    {\pi^2\over\sqrt2}\beta^{3\over2} \right)\]</div>
<p>and</p>
<div class="math">
\[{\delta U_{en}[n] \over \delta n}
    = \int {n_n(\mathbf{x}')\over
        |\mathbf{x} - \mathbf{x}'|}\d^3 x'
    \equiv V_{en}(\mathbf{x})\]</div>
<p>and</p>
<div class="math">
\[{\delta U_{ee}[n] \over \delta n}
    = \int {n(\mathbf{x}')\over
        |\mathbf{x} - \mathbf{x}'|}\d^3 x'
    \equiv V_{ee}(\mathbf{x})\]</div>
<p>and</p>
<div class="math">
\[{\delta F_{xc}[n] \over \delta n}
    = \epsilon_{xc}^{LD}(n) + n(\mathbf{x})
        {\d \epsilon_{xc}^{LD}(n) \over \d n}
    \equiv V_{xc}(\mathbf{x})\]</div>
<p>All together the Hamiltonian is:</p>
<div class="math">
\[H[n] =
    {1\over\beta} \left( f(y) + n(\mathbf{x}) {\d f(y) \over \d y}
    {\pi^2\over\sqrt2}\beta^{3\over2} \right)
    +
    V_{en}(\mathbf{x})
    +
    V_{ee}(\mathbf{x})
    +
    V_{xc}(\mathbf{x})\]</div>
<p>We can also introduce an artificial orbital <span class="math">\(\psi(\mathbf{x})\)</span> as follows:</p>
<div class="math">
\[n(\mathbf{x}) = \psi^2(\mathbf{x})\]</div>
<p>and minimize <span class="math">\(\Omega\)</span> with respect to <span class="math">\(\psi\)</span>:</p>
<div class="math">
\[{\delta \Omega[n] \over \delta \psi} = 0 \,.\]</div>
<p>We will use tilde to denote functions in terms of <span class="math">\(\psi\)</span>. So <span class="math">\(\Omega[n] =
\Omega[\psi^2] = \tilde \Omega[\psi]\)</span>.
Using the relation</p>
<div class="math">
\[{\delta \over \delta \psi}
    = {\d n \over \d \psi} {\delta \over \delta n}
    = 2 \psi {\delta \over \delta n}\]</div>
<p>we obtain:</p>
<div class="math">
\[{\delta \Omega[n] \over \delta \psi}
    = 2 \psi {\delta \Omega[n] \over \delta n} = 0 \,.\]</div>
<p>So the equation <a href="#equation-of-dft0">(18)</a> gets multiplied by <span class="math">\(2\psi\)</span>:</p>
<div class="math">
\[2\psi {\delta F_e[n] \over \delta n} = 2\epsilon \psi\]</div>
<p>as well as the equation <a href="#equation-of-dft">(19)</a>:</p>
<div class="math">
\[\tilde H[\psi] \equiv {\delta \tilde F_e[\psi] \over \delta \psi}
    = {\delta F_e[n] \over \delta \psi}
    = 2 \psi {\delta F_e[n] \over \delta n}
    = 2 H[n] \psi
    = 2\epsilon \psi\]</div>
<p>So the Hamiltonian <span class="math">\(H[n]\)</span> expressed using <span class="math">\(n\)</span> and the Hamiltonian
<span class="math">\(\tilde H[\psi]\)</span> expressed using <span class="math">\(\psi\)</span> are related by
<span class="math">\(\tilde H[\psi] = 2 H[n] \psi\)</span>.</p>
<div class="section" id="free-energy-minimization">
<h3>Free Energy Minimization<a class="headerlink" href="#free-energy-minimization" title="Permalink to this headline">¶</a></h3>
<p>For clarity, we will be using <span class="math">\(H[n]\)</span> from equation <a href="#equation-of-dft">(19)</a> as our main
quantity, but we will also write the final relations using <span class="math">\(\tilde H[\psi]\)</span> for
completeness.</p>
<p>We start with some initial guess for <span class="math">\(\ket{\psi}\)</span> (it must be normalized
as <span class="math">\(\braket{\psi | \psi}=N\)</span>).
Let&#8217;s calculate <span class="math">\(\epsilon\)</span>:</p>
<div class="math">
\[H[n] = \epsilon\]\[H[n]\ket{\psi} = \epsilon\ket{\psi}\]\[\braket{\psi | H[n] | \psi} = \epsilon\braket{\psi | \psi}\]\[\braket{\psi | H[n] | \psi} = \epsilon N\]\[\epsilon = {1\over N} \braket{\psi | H[n] | \psi}
    \equiv {1\over N} \int H[n] \psi^2(\mathbf{x}) \d^3 x
    = {1\over 2N} \int \tilde H[\psi] \psi(\mathbf{x}) \d^3 x\]</div>
<p>We calculate the steepest-descent (SD) vector <span class="math">\(\ket{\chi}\)</span>:</p>
<div class="math">
\[\ket{\chi} = 2(\epsilon - H[n])\ket{\psi}
    \equiv 2\epsilon \ket{\psi} - \ket{\tilde H[\psi]}\]</div>
<p>The conjugate-gradient (CG) vector <span class="math">\(\ket{\varphi}\)</span> is calculated as:</p>
<div class="math">
\[\ket{\varphi} = \ket{\chi} + {\braket{\chi | \chi} \over
    \braket{\chi_{k-1} | \chi_{k-1}}} \ket{\varphi}\]</div>
<p>To satisfy the normalization constraint of <span class="math">\(\ket{\psi}\)</span>, the CG vector is
further orthogonalized to <span class="math">\(\ket{\psi}\)</span> and normalized to <span class="math">\(N\)</span> (this step is one
particular, but not the only way to impose the normalization constraint):</p>
<div class="math">
\[\ket{\varphi'} = \left(1 - {1\over N} \ket{\psi}\bra{\psi}\right)
    \ket{\varphi}\]\[\ket{\varphi''} = \sqrt{N \over \braket{\varphi' | \varphi'}} \,
    \ket{\varphi'}\]</div>
<p>That is, now <span class="math">\(\braket{\varphi'' | \psi}=0\)</span> and
<span class="math">\(\braket{\varphi'' | \varphi''} = N\)</span>.
The new CG vector <span class="math">\(\ket{\psi_{k+1}}\)</span> is then updated as usual in CG by
<span class="math">\(\ket{\psi} + \alpha \ket{\varphi''}\)</span>, but then it must be normalized.
As such, equivalently, it is updated by a linear combination
of <span class="math">\(\ket{\psi}\)</span> and <span class="math">\(\ket{\varphi''}\)</span>:</p>
<div class="math">
\[\ket{\psi_{k+1}} = a \ket{\psi} + b \ket{\varphi''}\]</div>
<p>such that it remains normalized:</p>
<div class="math">
\[\braket{\psi_{k+1} | \psi_{k+1}}
    = (a \bra{\psi} + b \bra{\varphi''})
    (a \ket{\psi} + b \ket{\varphi''})
    = (a^2 + b^2) N = N\]</div>
<p>So <span class="math">\(a\)</span>, <span class="math">\(b\)</span> are any real numbers satisfying the equation <span class="math">\(a^2+b^2=1\)</span>, whose
parametric solution is <span class="math">\(a=\cos\theta\)</span>, <span class="math">\(b=\sin\theta\)</span> with <span class="math">\(0 \le \theta &lt;
2\pi\)</span>:</p>
<div class="math">
\[\ket{\psi_{k+1}} = \cos\theta \ket{\psi} + \sin\theta \ket{\varphi''}\]</div>
<p>where <span class="math">\(\theta\)</span> is determined by minimizing the free energy <span class="math">\(F_e[\psi_{k+1}]\)</span> as
a function of <span class="math">\(\theta\)</span>.</p>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<table class="docutils citation" frame="void" id="dft" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[DFT]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>, <a class="fn-backref" href="#id3">3</a>)</em> <ol class="last upperalpha simple" start="18">
<li><ol class="first upperalpha" start="13">
<li>Dreizler, E. K. U. Gross: Density functional theory: an approach to the quantum many-body problem</li>
</ol>
</li>
</ol>
</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="pickett" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[pickett]</td><td><em>(<a class="fn-backref" href="#id4">1</a>, <a class="fn-backref" href="#id5">2</a>)</em> <ol class="last upperalpha simple" start="23">
<li><ol class="first upperalpha" start="5">
<li>Pickett, Pseudopotential methods in condensed matter applications, Computer Physics reports, Volume 9, Issue 3, April 1989, Pages 115-197, ISSN 0167-7977, DOI: 10.1016/0167-7977(89)90002-6. (<a class="reference external" href="http://www.sciencedirect.com/science/article/B6X3V-46R02CR-1J/2/804d9ecaa49469aa5e1050dc007f4a61">http://www.sciencedirect.com/science/article/B6X3V-46R02CR-1J/2/804d9ecaa49469aa5e1050dc007f4a61</a>)</li>
</ol>
</li>
</ol>
</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Density Functional Theory (DFT)</a><ul>
<li><a class="reference internal" href="#many-body-schrodinger-equation">Many Body Schrödinger Equation</a></li>
<li><a class="reference internal" href="#the-hohenberg-kohn-theorem">The Hohenberg-Kohn Theorem</a></li>
<li><a class="reference internal" href="#the-kohn-sham-equations">The Kohn-Sham Equations</a></li>
<li><a class="reference internal" href="#the-xc-term">The XC Term</a></li>
<li><a class="reference internal" href="#total-energy">Total Energy</a></li>
<li><a class="reference internal" href="#xc-approximations">XC Approximations</a><ul>
<li><a class="reference internal" href="#lda">LDA</a></li>
<li><a class="reference internal" href="#rlda">RLDA</a></li>
</ul>
</li>
<li><a class="reference internal" href="#radial-dft-problem">Radial DFT Problem</a><ul>
<li><a class="reference internal" href="#kohn-sham-equations">Kohn-Sham Equations</a></li>
<li><a class="reference internal" href="#poisson-equation">Poisson Equation</a></li>
<li><a class="reference internal" href="#id6">Total Energy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dft-as-a-nonlinear-problem">DFT As a Nonlinear Problem</a><ul>
<li><a class="reference internal" href="#reformulation">Reformulation</a></li>
<li><a class="reference internal" href="#fe-discretization">FE Discretization</a></li>
<li><a class="reference internal" href="#jacobian">Jacobian</a></li>
</ul>
</li>
<li><a class="reference internal" href="#thomas-fermi-dirac-theory">Thomas-Fermi-Dirac Theory</a><ul>
<li><a class="reference internal" href="#top-down-approach">Top Down Approach</a></li>
<li><a class="reference internal" href="#bottom-up-approach">Bottom Up Approach</a></li>
</ul>
</li>
<li><a class="reference internal" href="#orbital-free-density-functional-theory">Orbital Free Density Functional Theory</a><ul>
<li><a class="reference internal" href="#free-energy-minimization">Free Energy Minimization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="radial.html"
                        title="previous chapter">Radial Schrödinger and Dirac Equations</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="hf.html"
                        title="next chapter">Hartree-Fock (HF) Method</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/quantum/dft.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="hf.html" title="Hartree-Fock (HF) Method"
             >next</a> |</li>
        <li class="right" >
          <a href="radial.html" title="Radial Schrödinger and Dirac Equations"
             >previous</a> |</li>
        <li><a href="../index.html">Theoretical Physics Reference 0.5 documentation</a> &raquo;</li>
          <li><a href="main.html" >Quantum Field Theory and Quantum Mechanics</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2011, Ondřej Čertík.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>